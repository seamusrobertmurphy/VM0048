<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Seamus Murphy">
<meta name="dcterms.date" content="2025-01-04">
<meta name="keywords" content="REDD+, VCS, Verra, Carbon verification, Jurisdictional">

<title>Deforestation Risk – VM0048</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-59898bd1c6b9d2bb783127feaa000c76.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-9d99e719fc96b51e8e93bebf106bf246.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Deforestation Risk – VM0048">
<meta property="og:description" content="A workflow for deriving jurisidictional risk-allocated deforestation mapping compliant with Verra’s VMD0055 (V1.1) module and the VM0048 (V1.0) consolidated methodology. This includes baseline estimates of forest change and jurisdictional allocated deforestation.">
<meta property="og:image" content="https://17c2998f-b511-4c3f-b44d-24cddc66219d.netlify.app/data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==">
<meta property="og:site_name" content="VM0048">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">VM0048</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./baseline.html"> 
<span class="menu-text">Baseline</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./deforisk.html"> 
<span class="menu-text">Risk</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./leakage.html"> 
<span class="menu-text">Leakage</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/seamusrobertmurphy/VM0048">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/seamusrobertmurphy/VM0048/issues">
            Report a Bug
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/seamusrobertmurphy/">
            Repo Collection
            </a>
          </li>
      </ul>
    </div>
    <a href="https://linkedin.com/in/seamusrobertmurphy" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./deforisk.html">Risk</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./baseline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Baseline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./deforisk.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Risk</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./leakage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Leakage</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">About</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resume</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./teaching/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Teaching</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="4">
    <h2 id="toc-title"><strong>Contents</strong></h2>
   
  <ul>
  <li><a href="#area-check" id="toc-area-check" class="nav-link active" data-scroll-target="#area-check">Area check</a></li>
  <li><a href="#activity-data" id="toc-activity-data" class="nav-link" data-scroll-target="#activity-data">Activity data</a>
  <ul>
  <li><a href="#training-samples" id="toc-training-samples" class="nav-link" data-scroll-target="#training-samples">Training samples</a></li>
  <li><a href="#raster-collection" id="toc-raster-collection" class="nav-link" data-scroll-target="#raster-collection">Raster collection</a></li>
  <li><a href="#image-classification" id="toc-image-classification" class="nav-link" data-scroll-target="#image-classification">Image classification</a></li>
  <li><a href="#model-calibration" id="toc-model-calibration" class="nav-link" data-scroll-target="#model-calibration">Model calibration</a></li>
  <li><a href="#forest-area" id="toc-forest-area" class="nav-link" data-scroll-target="#forest-area">Forest area</a></li>
  </ul></li>
  <li><a href="#deforestation-allocation" id="toc-deforestation-allocation" class="nav-link" data-scroll-target="#deforestation-allocation">Deforestation allocation</a>
  <ul>
  <li><a href="#demography-topography" id="toc-demography-topography" class="nav-link" data-scroll-target="#demography-topography">Demography &amp; topography</a></li>
  <li><a href="#annualized-deforestation" id="toc-annualized-deforestation" class="nav-link" data-scroll-target="#annualized-deforestation">Annualized deforestation</a></li>
  <li><a href="#distance-covariates" id="toc-distance-covariates" class="nav-link" data-scroll-target="#distance-covariates">Distance covariates</a></li>
  <li><a href="#deforestation-risk" id="toc-deforestation-risk" class="nav-link" data-scroll-target="#deforestation-risk">Deforestation risk</a></li>
  <li><a href="#appendix-i-reference-period-classifiers" id="toc-appendix-i-reference-period-classifiers" class="nav-link" data-scroll-target="#appendix-i-reference-period-classifiers">Appendix I: Reference Period Classifiers</a></li>
  <li><a href="#appendix-ii-runtime-snapshot" id="toc-appendix-ii-runtime-snapshot" class="nav-link" data-scroll-target="#appendix-ii-runtime-snapshot">Appendix II: Runtime snapshot</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Deforestation Risk</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Seamus Murphy <a href="mailto:seamusrobertmurphy@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-1792-0351" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 4, 2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    <p>A workflow for deriving jurisidictional risk-allocated deforestation mapping compliant with Verra’s <a href="https://verra.org/wp-content/uploads/2024/10/VMD0055-Estimation-of-Emission-Reductions-from-Avoiding-Unplanned-Deforestation-v1.1-CLEAN-2024.10.21.24.pdf">VMD0055 (V1.1)</a> module and the <a href="https://verra.org/wp-content/uploads/2023/11/VM0048-Reducing-Emissions-from-Deforestation-and-Forest-Degradation-v1.0-1-1.pdf">VM0048 (V1.0)</a> consolidated methodology. This includes baseline estimates of forest change and jurisdictional allocated deforestation.</p>
  </div>
</div>

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>REDD+, VCS, Verra, Carbon verification, Jurisdictional</p>
  </div>
</div>

</header>


<p><em>Import AOI &amp; visualize:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">77777</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Import project aoi</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>aoi <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"./data/aoi/AllLandscapes_merge_v02.shp"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Name) <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">4326</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    Name <span class="sc">==</span> <span class="st">"Gola Forest National Park"</span> <span class="sc">|</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      Name <span class="sc">==</span> <span class="st">"Norman"</span> <span class="sc">|</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      Name <span class="sc">==</span> <span class="st">"Tonglay"</span>) </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>aoi_gola <span class="ot">=</span> aoi <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Name <span class="sc">==</span> <span class="st">"Gola Forest National Park"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>aoi_tong <span class="ot">=</span> aoi <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Name <span class="sc">==</span> <span class="st">"Tonglay"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>aoi_norm <span class="ot">=</span> aoi <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Name <span class="sc">==</span> <span class="st">"Norman"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Import country aoi</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>query <span class="ot">=</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(<span class="st">"Liberia"</span>) <span class="sc">|&gt;</span> <span class="co"># opq = overpass query</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"boundary"</span>, <span class="at">value =</span> <span class="st">"administrative"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>()</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>boundaries <span class="ot">=</span> query<span class="sc">$</span>osm_multipolygons</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>country  <span class="ot">=</span> boundaries <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(admin_level <span class="sc">==</span> <span class="st">"2"</span>, name <span class="sc">==</span> <span class="st">"Liberia"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, admin_level, geometry) <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_cast</span>() <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">4326</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(country, <span class="st">"./data/aoi/liberia_boundary_national.shp"</span>, <span class="at">delete_layer=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="area-check" class="level2">
<h2 class="anchored" data-anchor-id="area-check">Area check</h2>
<p>In Liberia, the official definition of forest land is provided by the Forestry Development Authority <span class="citation" data-cites="governmentofliberia2019">(<a href="#ref-governmentofliberia2019" role="doc-biblioref">Government of Liberia 2019</a>)</span>, including areas of land that meet the following criteria:</p>
<ul>
<li>Canopy cover of minimum 30%;</li>
<li>Canopy height of minimum 5m or the capacity to reach it;</li>
<li>Covering a minimum of 1 hectare of land.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>leakage <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">as.polygons</span>(slope_1_only_glwd_clip) <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>leakage_country <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">as.polygons</span>(slope_1_only_glwd_clip_country) <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>leakage_country<span class="sc">$</span>area_ha <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_area</span>(leakage_country) <span class="sc">*</span> <span class="fl">0.0001</span>, <span class="dv">4</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>leakage_country <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> janitor<span class="sc">::</span><span class="fu">adorn_totals</span>() </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>leakage<span class="sc">$</span>area_ha <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_area</span>(leakage) <span class="sc">*</span> <span class="fl">0.0001</span>, <span class="dv">4</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>leakage <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> janitor<span class="sc">::</span><span class="fu">adorn_totals</span>() </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>slivers <span class="ot">=</span> aoi <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">as.numeric</span>(area_ha) <span class="sc">&lt;</span> <span class="dv">1</span>)  <span class="co"># no artefacts found</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Results indicate the spatial dataset is free from topological errors, and forest ‘islands’ and spatial artefacts smaller than approved area definition. Results also match Areahav2 values derived previously and reported in ER_Workbook_Gola_Liberia.xlsx</p>
</section>
<section id="activity-data" class="level2">
<h2 class="anchored" data-anchor-id="activity-data">Activity data</h2>
<p>This section documents inputs and procedures used to derive national and project-level deforestation maps. This follows three main steps:</p>
<ul>
<li>Compare land cover training samples for Liberia;</li>
<li>Classify &amp; assess accuracy of forest cover maps for 2014, 2019, and 2024;</li>
<li>Spatially map deforestation risk, allocate jurisdictional deforestation &amp; compare with FREL.</li>
</ul>
<section id="training-samples" class="level4">
<h4 class="anchored" data-anchor-id="training-samples">Training samples</h4>
<p>Training samples for the country and project area were extracted from two gold standard global land cover time series datasets: the GLanCE dataset <span class="citation" data-cites="stanimirovaGlobalLandCover2023">(<a href="#ref-stanimirovaGlobalLandCover2023" role="doc-biblioref">Stanimirova et al. 2023</a>)</span> and TimeSpec4LULC dataset. Both training datasets were processed with continuous change and class migration algorithms. While Verra is yet to establish requirements for addressing feature class migration in classification of baseline activity data <span class="citation" data-cites="verraVM0048ReducingEmissions2023a verraVMD0055EstimationEmission2024 verraVT0007UnplannedDeforestation2021">(<a href="#ref-verraVM0048ReducingEmissions2023a" role="doc-biblioref"><strong>verraVM0048ReducingEmissions2023a?</strong></a>; <a href="#ref-verraVMD0055EstimationEmission2024" role="doc-biblioref"><strong>verraVMD0055EstimationEmission2024?</strong></a>; <a href="#ref-verraVT0007UnplannedDeforestation2021" role="doc-biblioref">Verra 2021</a>)</span>, we may recommend incorporating this remote sensing best practice or showcase its improvements to accuracy metrics, as follows.</p>
<p><em>Table 2: Class conversions of training samples</em></p>
<p><img src="data/tables/Table 2 Training samples class conversions.png" class="img-fluid"></p>
<p>Level-1 classes in the GLanCE and TimeSpec4LULC datasets were recoded below to match class labels cited in the “Lookups” sheet of “ER_Workbook_Gola_Liberia.xlsx”, and the report titled “Liberia’s Forest Reference Emission Level Submission to the UNFCCC <span class="citation" data-cites="woodcockGlobalLandCover governmentofliberiaLiberiasForestReference2019">(<a href="#ref-woodcockGlobalLandCover" role="doc-biblioref">Woodcock et al., n.d.</a>; <a href="#ref-governmentofliberiaLiberiasForestReference2019" role="doc-biblioref"><strong>governmentofliberiaLiberiasForestReference2019?</strong></a>)</span>.</p>
<p>To address class imbalances, the Winrock team derived additional training samples and appended to the GLanCE datapoint collection. This sampling aimed to improve class-to-country proportionality while targeting plot-to-pixel dimensions and homogenous rule throughout training sample selection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import &amp; tidy samples</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>samples_raw <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"./data/training_samples/glance_training.csv"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>samples_clean <span class="ot">=</span> samples_raw <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Lon, Lat, Glance_Class_ID_level1, Start_Year, End_Year)<span class="sc">|&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">longitude =</span> Lon) <span class="sc">|&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">latitude =</span> Lat) <span class="sc">|&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">label_old =</span> Glance_Class_ID_level1) <span class="sc">|&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">start_date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(Start_Year,<span class="st">"01"</span>,<span class="st">"01"</span>,<span class="at">sep =</span> <span class="st">"-"</span>)))<span class="sc">|&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">end_date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(End_Year, <span class="st">"01"</span>, <span class="st">"01"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)))<span class="sc">|&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(longitude, latitude, start_date, end_date, label_old)<span class="sc">|&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">code =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    label_old <span class="sc">==</span> <span class="st">'4'</span> <span class="sc">~</span> <span class="dv">0</span>, </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    label_old <span class="sc">==</span> <span class="st">'7'</span> <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    label_old <span class="sc">==</span> <span class="st">'6'</span> <span class="sc">~</span> <span class="dv">2</span>, </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    label_old <span class="sc">==</span> <span class="st">'5'</span> <span class="sc">~</span> <span class="dv">3</span>, </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    label_old <span class="sc">==</span> <span class="st">'1'</span> <span class="sc">~</span> <span class="dv">4</span>, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    label_old <span class="sc">==</span> <span class="st">'3'</span> <span class="sc">~</span> <span class="dv">99</span>, </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    label_old <span class="sc">==</span> <span class="st">'2'</span> <span class="sc">~</span> <span class="dv">88</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    code <span class="sc">==</span> <span class="st">'0'</span>  <span class="sc">~</span> <span class="st">"Bareground"</span>, </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    code <span class="sc">==</span> <span class="st">'1'</span>  <span class="sc">~</span> <span class="st">"Regrowth"</span>, </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    code <span class="sc">==</span> <span class="st">'2'</span>  <span class="sc">~</span> <span class="st">"Farmbush"</span>, </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    code <span class="sc">==</span> <span class="st">'3'</span>  <span class="sc">~</span> <span class="st">"Forest"</span>, </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    code <span class="sc">==</span> <span class="st">'4'</span>  <span class="sc">~</span> <span class="st">"Water"</span>, </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    code <span class="sc">==</span> <span class="st">'99'</span> <span class="sc">~</span> <span class="st">"Urban"</span>, </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    code <span class="sc">==</span> <span class="st">'88'</span> <span class="sc">~</span> <span class="st">"Snow"</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">as.factor</span>(label)) <span class="sc">|&gt;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>label_old)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to project area</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>samples_sf       <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(samples_clean, <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>))</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>samples_clipped  <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_intersection</span>(samples_sf, country) <span class="co"># n = 364</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>samples_country  <span class="ot">=</span> samples_sf[samples_clipped, ] <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">4326</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>samples          <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_crop</span>(samples_country, <span class="fu">st_bbox</span>(country))</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(samples, <span class="st">"./data/training_samples/glance_spatial_clip.shp"</span>, <span class="at">delete_dsn =</span> T)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(samples, <span class="st">"./data/training_samples/glance_spatial_clip.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(samples, label)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Winrock training samples</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>samples_winrock <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/training_samples/samples_winrock3.shp"</span>) <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_cast</span>() <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">4326</span>)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co">#samples_winrock &lt;- sf::st_read("./data/training_samples/samples_winrock2.shp") |&gt; sf::st_cast() |&gt; sf::st_transform(4326)</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co">#samples_winrock &lt;- sf::st_read("./data/training_samples/samples_winrock.shp") |&gt; sf::st_cast() |&gt; sf::st_transform(4326)</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>samples_winrock <span class="ot">&lt;-</span> samples_winrock <span class="sc">|&gt;</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Name)<span class="sc">|&gt;</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_date =</span> <span class="fu">as.Date</span>(<span class="st">"2014-01-01"</span>),</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date =</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-01"</span>),</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">row_number</span>()</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>samples_winrock<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(samples_winrock<span class="sc">$</span>Name, <span class="st">"^Bareland"</span>)  <span class="sc">~</span> <span class="st">"Bareground"</span>,</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(samples_winrock<span class="sc">$</span>Name, <span class="st">"^Regrowth"</span>)  <span class="sc">~</span> <span class="st">"Regrowth"</span>,</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(samples_winrock<span class="sc">$</span>Name, <span class="st">"^Farmbush"</span>)  <span class="sc">~</span> <span class="st">"Farmbush"</span>,</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(samples_winrock<span class="sc">$</span>Name, <span class="st">"^Forest"</span>)  <span class="sc">~</span> <span class="st">"Forest"</span>,</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(samples_winrock<span class="sc">$</span>Name, <span class="st">"^Water"</span>)   <span class="sc">~</span> <span class="st">"Water"</span>,</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(samples_winrock<span class="sc">$</span>Name, <span class="st">"^Swamp"</span>)   <span class="sc">~</span> <span class="st">"Swamp"</span>,</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"MISSING"</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">as.factor</span>()</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>samples_winrock<span class="sc">$</span>code <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>  samples_winrock<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"Bareground"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>  samples_winrock<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"Regrowth"</span>   <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  samples_winrock<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"Farmbush"</span>   <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>  samples_winrock<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"Water"</span>      <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>  samples_winrock<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"Swamp"</span>      <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span>                                  <span class="sc">~</span> <span class="cn">NA_real_</span>  <span class="co"># Use NA_real_ for numeric NA</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>samples_winrock <span class="ot">&lt;-</span> samples_winrock[<span class="sc">!</span>(samples_winrock<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"Forest"</span>), ]</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>samples_winrock<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(samples_winrock<span class="sc">$</span>label)</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>samples_winrock <span class="ot">&lt;-</span> samples_winrock <span class="sc">|&gt;</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Name)</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>samples_combined <span class="ot">&lt;-</span> <span class="fu">rbind</span>(samples, samples_winrock)</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(samples_combined, <span class="st">"./data/training_samples/samples_combined.shp"</span>, <span class="at">delete_dsn=</span>T)</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/training_samples/samples_combined.shp"</span>)</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(samples, label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="raster-collection" class="level4">
<h4 class="anchored" data-anchor-id="raster-collection">Raster collection</h4>
<p>The dataset of STAC-formatted Landsat Collection-2-Level-2 was extracted from the Google Earth Engine Catalog and processed using a cloudless and pixel quality ranking mask before back-filling with median normalization. This was implemented in a <a href="https://colab.research.google.com/github/seamusrobertmurphy/01-data-processing/blob/main/01-data-processing.ipynb">Colab python runtime here</a>. The collection of unclassified rasters was temporarily stored in a <a href="https://drive.google.com/drive/folders/1XMYYhBUAsvuZ02avsZHYHDTArqztLaFI?usp=drive_link">Google Drive folder</a> and the consolidated, resampled and labelled full stack is available to download directly from <a href="https://drive.google.com/file/d/1Vn0KDzkFDaBhpdC803IbYVRuu5cHx0SO/view?usp=drive_link">here</a>. In addition, full script and all runtime setups are available from the project’s github repository here</p>
<p>Landsat data was acquired instead of Sentinel imagery due to start date of project’s 10-year baseline occurring before the launch of the Sentinel 2 satellite. The following chunk provides an alternative worflow, though less reliable, R-native workflow for acquiring, aligning, and processing rasters for the extent of Liberia.</p>
<p>The processes above were repeated for three baseline interval years of 2014, 2019, and 2024 and then saved into consolidated raster stack and visualized below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>NDVI_2014<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/STACK/LANDSAT_TM-ETM-OLI_198055_NDVI_2014-01-04.tif"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>NDVI_2019<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/STACK/LANDSAT_TM-ETM-OLI_198055_NDVI_2019-01-02.tif"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>NDVI_2024<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/STACK/LANDSAT_TM-ETM-OLI_198055_NDVI_2024-01-16.tif"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>STACK<span class="ot">=</span>raster<span class="sc">::</span><span class="fu">brick</span>(<span class="st">"./data/STACK/LANDSAT_TM-ETM-OLI_198055_STACK-&amp;-DEM_2014-01-04_2024-01-16_INTERP.tif"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(NDVI_2014, <span class="at">main =</span> <span class="st">"NDVI Distribution, 2014"</span>, <span class="at">col =</span> <span class="st">"springgreen"</span>) </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(NDVI_2019, <span class="at">main =</span> <span class="st">"NDVI Distribution, 2019"</span>, <span class="at">col =</span> <span class="st">"springgreen"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(NDVI_2024, <span class="at">main =</span> <span class="st">"NDVI Distribution, 2024"</span>, <span class="at">col =</span> <span class="st">"springgreen"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(NDVI_2014,<span class="at">main=</span><span class="st">"NDVI, 2014"</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">11.5</span>,<span class="sc">-</span><span class="fl">7.5</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="fl">4.1</span>,<span class="fl">8.6</span>),<span class="at">border=</span><span class="st">"gray"</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(samples), <span class="at">add=</span>T)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(NDVI_2019,<span class="at">main=</span><span class="st">"NDVI, 2014"</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">11.5</span>,<span class="sc">-</span><span class="fl">7.5</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="fl">4.1</span>,<span class="fl">8.6</span>),<span class="at">border=</span><span class="st">"gray"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(samples), <span class="at">add=</span>T)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(NDVI_2024,<span class="at">main=</span><span class="st">"NDVI, 2014"</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">11.5</span>,<span class="sc">-</span><span class="fl">7.5</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="fl">4.1</span>,<span class="fl">8.6</span>),<span class="at">border=</span><span class="st">"gray"</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(samples), <span class="at">add=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="image-classification" class="level4">
<h4 class="anchored" data-anchor-id="image-classification">Image classification</h4>
<p>We trained a Random Forest model fitted with 500 decision trees. The dataset was partitioned using a 70:30 ratio which was which was trained using Monte Carlo resampling regime (k=100). Accuracy assessments were reported using a confusion matrix. Uncertainty metrics were then used to explore best subset of variables according to magnitude and performances of recursive modeling, which informed final model selection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract signatures</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>signatures_2014 <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">extract</span>(STACK_2014, samples ,<span class="at">df=</span>T) <span class="co"># watch for data formats</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>samples_signatures_2014 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(signatures_2014, samples, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"ID"</span><span class="ot">=</span><span class="st">"id"</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>samples_signatures_2014<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># set geometry to NULL for model training</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Stratify to ensure all classes are present in both train and test</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>stratified_partition <span class="ot">&lt;-</span> <span class="cf">function</span>(data, group_col, <span class="at">train_ratio =</span> <span class="fl">0.7</span>) {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  split_data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">split</span>(data, data[[group_col]]), <span class="cf">function</span>(df) {</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    train_size <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">floor</span>(train_ratio <span class="sc">*</span> <span class="fu">nrow</span>(df)))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    train_idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(df)), <span class="at">size =</span> train_size)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">train =</span> df[train_idx, ], <span class="at">test =</span> df[<span class="sc">-</span>train_idx, ])</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(split_data, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="st">"train"</span>))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(split_data, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="st">"test"</span>))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">train =</span> train_data, <span class="at">test =</span> test_data)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>partitioned_data_2014 <span class="ot">&lt;-</span> <span class="fu">stratified_partition</span>(samples_signatures_2014,<span class="at">group_col=</span><span class="st">"label"</span>, <span class="at">train_ratio=</span><span class="fl">0.7</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>trainData_2014 <span class="ot">&lt;-</span> partitioned_data_2014<span class="sc">$</span>train</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>testData_2014 <span class="ot">&lt;-</span> partitioned_data_2014<span class="sc">$</span>test</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#table(trainData_2014$label)</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#table(testData_2014$label)</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co"># synthetic minotrity oversampling technique</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>trainData_2014<span class="ot">&lt;-</span>performanceEstimation<span class="sc">::</span><span class="fu">smote</span>(label <span class="sc">~</span> .,<span class="at">data=</span>trainData_2014,<span class="at">perc.over=</span><span class="dv">30</span>,<span class="at">perc.under=</span><span class="dv">30</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>testData_2014<span class="ot">&lt;-</span>performanceEstimation<span class="sc">::</span><span class="fu">smote</span>(label <span class="sc">~</span> .,<span class="at">data=</span>testData_2014,<span class="at">perc.over=</span><span class="dv">30</span>,<span class="at">perc.under=</span><span class="dv">30</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># interpolate missing cloud pixels with class-median-normalization</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>trainData_2014 <span class="ot">&lt;-</span> trainData_2014 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(label) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">median</span>(., <span class="at">na.rm =</span> T), .))) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>testData_2014 <span class="ot">&lt;-</span> testData_2014 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(label) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">median</span>(., <span class="at">na.rm =</span> T), .))) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co"># assign model variables</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>response  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"label"</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>predictors_2014 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NDVI_2014"</span>, <span class="st">"BLUE_2014"</span>, <span class="st">"GREEN_2014"</span>, <span class="st">"RED_2014"</span>, </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NIR08_2014"</span>, <span class="st">"SWIR16_2014"</span>, <span class="st">"SWIR22_2014"</span>, <span class="st">"DEM"</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="co"># set training parameters</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>cv_regime <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">method          =</span> <span class="st">'LGOCV'</span>,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">number          =</span> <span class="dv">100</span>,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> T,</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">verboseIter     =</span> F</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="co"># train classifier</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>rf_model_2014 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  label<span class="sc">~</span>.,</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> trainData_2014[, <span class="fu">c</span>(predictors_2014, <span class="st">"label"</span>)], <span class="co"># drop ID var</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> cv_regime,</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">method    =</span> <span class="st">"rf"</span>, </span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric    =</span> <span class="st">'Kappa'</span>, </span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree     =</span> <span class="dv">500</span>,</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength=</span> <span class="dv">6</span>,</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance=</span> T</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Accuracy assessments</em></strong><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Results suggested a moderate concordance between observed and predicted classes with optimal model performance during cross-validation at mtry of 3. Overall statistics reported Kappa Index of 71.04%, Accuracy of 88.61% (0.95CI 84.46%, 95.71%), and a smaller No Information Rate of 0.8158 (p&lt;0.01). In addition, key classes of <code>Forest</code> were predicted with robust Sensitivity (98.92%) and Specificity (76.16%).</p>
<p>To address model weaknesses, the team recommends sourcing additional verified training samples, or alternatively applying a weighted Random Forest, Gradient Boosting or Support Vector Machines kernels (SVM) to improve performance of underrepresented classes. Note, these modeling updates will require substantial runtimes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>rf_test_2014 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model_2014, testData_2014)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model_2014) <span class="co"># cv results</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(rf_test_2014,testData_2014<span class="sc">$</span>label) <span class="co"># blind test results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Random Forest 

1862 samples
   8 predictor
   7 classes: 'Bareground', 'Farmbush', 'Forest', 'Regrowth', 'Swamp', 'Urban', 'Water' 

No pre-processing
Resampling: Repeated Train/Test Splits Estimated (100 reps, 75%) 
Summary of sample sizes: 1399, 1399, 1399, 1399, 1399, 1399, ... 
Resampling results across tuning parameters:

  mtry  Accuracy   Kappa    
  2     0.9976674  0.9935532
  3     0.9976674  0.9935535
  4     0.9976674  0.9935553
  5     0.9976674  0.9935596
  6     0.9976674  0.9935626
  8     0.9976674  0.9935652

Kappa was used to select the optimal model using the largest value.
The final value used for the model was mtry = 8.
Confusion Matrix and Statistics

            Reference
Prediction   Bareground Farmbush Forest Regrowth Swamp Urban Water
  Bareground         28        8      0        0     0     3     0
  Farmbush            0       10      0        0     0     0     0
  Forest              4        0    696        8     0     0     0
  Regrowth            0        0      8       41     0     0     0
  Swamp               0        0      0        0    31     0     0
  Urban               0        4      0        0     0    80     0
  Water               0        0      0        0     0     0    10

Overall Statistics
                                          
               Accuracy : 0.9624          
                 95% CI : (0.9481, 0.9737)
    No Information Rate : 0.7562          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.9086          
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: Bareground Class: Farmbush Class: Forest Class: Regrowth Class: Swamp Class: Urban
Sensitivity                    0.87500         0.45455        0.9886         0.83673       1.0000      0.96386
Specificity                    0.98776         1.00000        0.9471         0.99093       1.0000      0.99528
Pos Pred Value                 0.71795         1.00000        0.9831         0.83673       1.0000      0.95238
Neg Pred Value                 0.99552         0.98697        0.9641         0.99093       1.0000      0.99646
Prevalence                     0.03437         0.02363        0.7562         0.05263       0.0333      0.08915
Detection Rate                 0.03008         0.01074        0.7476         0.04404       0.0333      0.08593
Detection Prevalence           0.04189         0.01074        0.7605         0.05263       0.0333      0.09023
Balanced Accuracy              0.93138         0.72727        0.9679         0.91383       1.0000      0.97957
                     Class: Water
Sensitivity               1.00000
Specificity               1.00000
Pos Pred Value            1.00000
Neg Pred Value            1.00000
Prevalence                0.01074
Detection Rate            0.01074
Detection Prevalence      0.01074
Balanced Accuracy         1.00000</code></pre>
</section>
<section id="model-calibration" class="level4">
<h4 class="anchored" data-anchor-id="model-calibration">Model calibration</h4>
<p>We employed recursive predictor subsetting to identify predictors of greatest magnitude and non-informative features to enhance model performance and reduce model complexity, respectively. This aims to limit potential of multicolinearity, despite inherent robustness of randomForest algorithms against such violations. The subsetted model was evaluated on the test dataset. The confusion matrix and performance metrics were summarized below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>index_feature_2014 <span class="ot">&lt;-</span> <span class="fu">createMultiFolds</span>(trainData_2014<span class="sc">$</span>label, <span class="at">times=</span><span class="dv">5</span>) </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>predictor_seq_2014 <span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>, <span class="at">to=</span><span class="fu">length</span>(predictors_2014),<span class="at">by=</span><span class="dv">2</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>subset_regime_2014 <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"LGOCV"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose=</span><span class="cn">FALSE</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">functions=</span>rfFuncs,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">index=</span>index_feature_2014</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>rf_model_subset_2014 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">rfe</span>(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  label<span class="sc">~</span>.,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> trainData_2014[, <span class="fu">c</span>(predictors_2014, <span class="st">"label"</span>)], </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> predictor_seq_2014,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"Kappa"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree=</span><span class="dv">500</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"rf"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">rfeControl =</span> subset_regime_2014</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>rf_subset_test_2014 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model_subset_2014,testData_2014)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model_subset_2014)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(rf_subset_test_2014<span class="sc">$</span>pred,testData_2014<span class="sc">$</span>label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Recursive feature selection

Outer resampling method: Repeated Train/Test Splits Estimated (50 reps, 75%) 

Resampling performance over subset size:


The top 3 variables (out of 3):
   BLUE_2014, DEM, SWIR22_2014

Confusion Matrix and Statistics

            Reference
Prediction   Bareground Farmbush Forest Regrowth Swamp Urban Water
  Bareground         28        8     12        0     0     3     0
  Farmbush            0       10      8        0     0     0     0
  Forest              4        4    679       32    31     9     0
  Regrowth            0        0      0        0     0     0     0
  Swamp               0        0      0        0     0    10     0
  Urban               0        0      5       17     0    61     0
  Water               0        0      0        0     0     0    10

Overall Statistics
                                         
               Accuracy : 0.8464         
                 95% CI : (0.8216, 0.869)
    No Information Rate : 0.7562         
    P-Value [Acc &gt; NIR] : 1.085e-11      
                                         
                  Kappa : 0.5879         
                                         
 Mcnemar's Test P-Value : NA             

Statistics by Class:

                     Class: Bareground Class: Farmbush Class: Forest Class: Regrowth Class: Swamp Class: Urban Class: Water
Sensitivity                    0.87500         0.45455        0.9645         0.00000      0.00000      0.73494      1.00000
Specificity                    0.97442         0.99120        0.6476         1.00000      0.98889      0.97406      1.00000
Pos Pred Value                 0.54902         0.55556        0.8946             NaN      0.00000      0.73494      1.00000
Neg Pred Value                 0.99545         0.98686        0.8547         0.94737      0.96634      0.97406      1.00000
Prevalence                     0.03437         0.02363        0.7562         0.05263      0.03330      0.08915      0.01074
Detection Rate                 0.03008         0.01074        0.7293         0.00000      0.00000      0.06552      0.01074
Detection Prevalence           0.05478         0.01933        0.8153         0.00000      0.01074      0.08915      0.01074
Balanced Accuracy              0.92471         0.72287        0.8060         0.50000      0.49444      0.85450      1.00000


 
 
Variables Accuracy Kappa AccuracySD KappaSD Selected
1   1   0.9981  0.9949  0.003389    0.008870    
2   3   0.9994  0.9983  0.001759    0.004588    *
3   5   0.9991  0.9978  0.001984    0.005188    
4   7   0.9989  0.9972  0.002423    0.006388    
5   8   0.9989  0.9972  0.002423    0.006388    </code></pre>
<table class="caption-top table">
<colgroup>
<col style="width: 4%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;"><p>Va riables</p>
<p>&lt;S3: AsIs&gt;</p></th>
<th style="text-align: right;"><p>A ccuracy</p>
<p>&lt;S3: AsIs&gt;</p></th>
<th style="text-align: right;"><p>Kappa</p>
<p>&lt;S3: AsIs&gt;</p></th>
<th style="text-align: right;"><p>Acc uracySD</p>
<p>&lt;S3: AsIs&gt;</p></th>
<th style="text-align: right;"><p>KappaSD</p>
<p>&lt;S3: AsIs&gt;</p></th>
<th style="text-align: right;"><p>S elected</p>
<p>&lt;S3: AsIs&gt;</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.9981</td>
<td style="text-align: right;">0.9949</td>
<td style="text-align: right;">0 .003389</td>
<td style="text-align: right;">0 .008870</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.9994</td>
<td style="text-align: right;">0.9983</td>
<td style="text-align: right;">0 .001759</td>
<td style="text-align: right;">0 .004588</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.9991</td>
<td style="text-align: right;">0.9978</td>
<td style="text-align: right;">0 .001984</td>
<td style="text-align: right;">0 .005188</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.9989</td>
<td style="text-align: right;">0.9972</td>
<td style="text-align: right;">0 .002423</td>
<td style="text-align: right;">0 .006388</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.9989</td>
<td style="text-align: right;">0.9972</td>
<td style="text-align: right;">0 .002423</td>
<td style="text-align: right;">0 .006388</td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
<p>In summary, the subset model achieved an Accuracy of 88.58% and a Kappa Index of 0.6338. These metrics closely align with the results of the original model, suggesting minimal or no loss in predictive power despite using fewer predictors. Similarly, high-performing classes of <code>Forest</code> maintained sensitivity and specificity (SE = 0.9667, SP = 0.8462). Given that the reduction in complexity offered by the subsetted model does not provide significant benefits in this context, we recommend proceeding with the original model to make spatial predictions.</p>
<p>These modelling operations were repeated for 2019 and 2024 (see Appendix).</p>
<p>Spatial predictions were made using their respective models and outputs of classified LULC rasters were saved in the same Google Drive folder linked above in previous sections.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/covariates/places_poly_county.shp"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>jurisdiction <span class="ot">=</span> counties <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  name <span class="sc">==</span> <span class="st">"Grand Cape Mount County"</span> <span class="sc">|</span> name <span class="sc">==</span> <span class="st">"Gharpolu County"</span> ) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>jurisdiction<span class="sc">$</span>name <span class="ot">=</span> <span class="st">'Grand Cape Mount &amp; Gharpolu Counties'</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>LULC_COUNTY_2014<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/LULC_LIBERIA_2014-01-04.tif"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(jurisdiction, <span class="at">mask=</span>T) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">trim</span>()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>LULC_COUNTY_2019<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/LULC_LIBERIA_2019-01-02.tif"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(jurisdiction, <span class="at">mask=</span>T) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">trim</span>()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>LULC_COUNTY_2024<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/LULC_LIBERIA_2024-01-16.tif"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(jurisdiction, <span class="at">mask=</span>T) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">trim</span>()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>code_dict <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Bareground"</span>, <span class="st">"Cropland"</span>, <span class="st">"Forest"</span>, <span class="st">"Shrubland"</span>, <span class="st">"Wetland"</span>, <span class="st">"Urban"</span>, <span class="st">"Water"</span>))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_COUNTY_2014) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_COUNTY_2019) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_COUNTY_2024) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>LULC_COUNTY_2014 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">project</span>(LULC_COUNTY_2014, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>LULC_COUNTY_2019 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">project</span>(LULC_COUNTY_2019, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>LULC_COUNTY_2024 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">project</span>(LULC_COUNTY_2024, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>jurisdiction <span class="ot">=</span> jurisdiction <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">project</span>(<span class="st">"EPSG:32629"</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>pixel_area_ha <span class="ot">&lt;-</span> <span class="fl">0.088914</span>  <span class="co"># 29.80124 x 29.80124 m² converted to hectares</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>compute_land_cover_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(jurisdiction, rasters, pixel_area) {</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (terra<span class="sc">::</span><span class="fu">nrow</span>(jurisdiction) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"The provided SpatVector jurisdiction is empty."</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (region <span class="cf">in</span> <span class="fu">unique</span>(jurisdiction<span class="sc">$</span>name)) {</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(rasters)) {</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>      cropped_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>        rasters[[year]],</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        jurisdiction[jurisdiction<span class="sc">$</span>name <span class="sc">==</span> region, ],</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">mask =</span> <span class="cn">TRUE</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (terra<span class="sc">::</span><span class="fu">ncell</span>(cropped_raster) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Cropped raster for"</span>, region, year, <span class="st">"is empty. Skipping."</span>))</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>      freq <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">freq</span>(cropped_raster)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>area_ha <span class="ot">&lt;-</span> freq<span class="sc">$</span>count <span class="sc">*</span> pixel_area</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>percentage <span class="ot">&lt;-</span> (freq<span class="sc">$</span>area_ha <span class="sc">/</span> <span class="fu">sum</span>(freq<span class="sc">$</span>area_ha)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>region <span class="ot">&lt;-</span> region</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>year <span class="ot">&lt;-</span> year</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>      results[[<span class="fu">paste</span>(region, year, <span class="at">sep =</span> <span class="st">"_"</span>)]] <span class="ot">&lt;-</span> freq</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">do.call</span>(rbind, results))</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Organize rasters into a named list</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>rasters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2014"</span> <span class="ot">=</span> LULC_COUNTY_2014,</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2019"</span> <span class="ot">=</span> LULC_COUNTY_2019,</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2024"</span> <span class="ot">=</span> LULC_COUNTY_2024</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute land cover summary</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>land_cover_summary <span class="ot">&lt;-</span> <span class="fu">compute_land_cover_summary</span>(jurisdiction, rasters, pixel_area_ha)</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(land_cover_summary, <span class="st">"./data/tables/land_cover_stats.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>land_cover_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2014<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/LULC_LIBERIA_2014-01-04.tif"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2019<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/LULC_LIBERIA_2019-01-02.tif"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2024<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/LULC_LIBERIA_2024-01-16.tif"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>code_dict <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bareground"</span>, <span class="st">"Cropland"</span>, </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Forest"</span>, <span class="st">"Shrubland"</span>, </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Wetland"</span>, <span class="st">"Urban"</span>, </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Water"</span>))</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_LIBERIA_2014) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_LIBERIA_2019) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_LIBERIA_2024) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2014 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">project</span>(LULC_LIBERIA_2014, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2019 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">project</span>(LULC_LIBERIA_2019, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2024 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">project</span>(LULC_LIBERIA_2024, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>country_metric <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(country, <span class="dv">32629</span>) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>pixel_area_ha <span class="ot">&lt;-</span> <span class="fl">0.088914</span>  <span class="co"># 29.80124 x 29.80124 m² converted to hectares</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>compute_land_cover_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(country_metric, rasters, pixel_area) {</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (terra<span class="sc">::</span><span class="fu">nrow</span>(country_metric) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"The provided SpatVector jurisdiction is empty."</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (region <span class="cf">in</span> <span class="fu">unique</span>(country_metric<span class="sc">$</span>name)) {</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(rasters)) {</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>      cropped_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        rasters[[year]],</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        country_metric[country_metric<span class="sc">$</span>name <span class="sc">==</span> region, ],</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">mask =</span> <span class="cn">TRUE</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (terra<span class="sc">::</span><span class="fu">ncell</span>(cropped_raster) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Cropped raster for"</span>, region, year, <span class="st">"is empty. Skipping."</span>))</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>      freq <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">freq</span>(cropped_raster)</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>area_ha <span class="ot">&lt;-</span> freq<span class="sc">$</span>count <span class="sc">*</span> pixel_area</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>percentage <span class="ot">&lt;-</span> (freq<span class="sc">$</span>area_ha <span class="sc">/</span> <span class="fu">sum</span>(freq<span class="sc">$</span>area_ha)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>region <span class="ot">&lt;-</span> region</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>year <span class="ot">&lt;-</span> year</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>      results[[<span class="fu">paste</span>(region, year, <span class="at">sep =</span> <span class="st">"_"</span>)]] <span class="ot">&lt;-</span> freq</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">do.call</span>(rbind, results))</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Organize rasters into a named list</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>rasters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2014"</span> <span class="ot">=</span> LULC_LIBERIA_2014,</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2019"</span> <span class="ot">=</span> LULC_LIBERIA_2019,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2024"</span> <span class="ot">=</span> LULC_LIBERIA_2024</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute land cover summary</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>land_cover_summary <span class="ot">&lt;-</span> <span class="fu">compute_land_cover_summary</span>(country_metric, rasters, pixel_area_ha)</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(land_cover_summary, <span class="st">"./data/tables/land_cover_country.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>land_cover_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>country_merc <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(country, <span class="dv">3857</span>) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2017<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/IO_LULC_LIBERIA_2017.tif"</span>) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">crop</span>(country_merc, <span class="at">mask=</span>T)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2023<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/IO_LULC_LIBERIA_2023.tif"</span>) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">crop</span>(country_merc, <span class="at">mask=</span>T)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>code_dict <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">11</span>),  </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Water"</span>, <span class="st">"Forest"</span>, <span class="st">"Wetland"</span>, <span class="st">"Bareground"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Built"</span>, <span class="st">"Cropland"</span>, <span class="st">"Rangeland"</span>))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_LIBERIA_2017) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_LIBERIA_2023) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>pixel_area_ha <span class="ot">&lt;-</span> <span class="fu">res</span>(LULC_LIBERIA_2017)[<span class="dv">1</span>] <span class="sc">*</span> <span class="fu">res</span>(LULC_LIBERIA_2017)[<span class="dv">2</span>] <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>compute_land_cover_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(country_merc, rasters, pixel_area) {</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (terra<span class="sc">::</span><span class="fu">nrow</span>(country_merc) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    {<span class="fu">stop</span>(<span class="st">"The provided SpatVector jurisdiction is empty."</span>)}</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (region <span class="cf">in</span> <span class="fu">unique</span>(country_merc<span class="sc">$</span>name)) </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    {<span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(rasters)) </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      {cropped_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(rasters[[year]],</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        country_merc[country_merc<span class="sc">$</span>name <span class="sc">==</span> region, ],</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">mask =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (terra<span class="sc">::</span><span class="fu">ncell</span>(cropped_raster) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        {<span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Cropped raster for"</span>, region, year, <span class="st">"is empty. Skipping."</span>))<span class="cf">next</span>}</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>      freq <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">freq</span>(cropped_raster)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>area_ha <span class="ot">=</span> freq<span class="sc">$</span>count <span class="sc">*</span> pixel_area</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>percentage <span class="ot">=</span> (freq<span class="sc">$</span>area_ha <span class="sc">/</span> <span class="fu">sum</span>(freq<span class="sc">$</span>area_ha)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>region <span class="ot">=</span> region</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>year <span class="ot">=</span> year</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>      results[[<span class="fu">paste</span>(region, year, <span class="at">sep =</span> <span class="st">"_"</span>)]] <span class="ot">&lt;-</span> freq</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">do.call</span>(rbind, results))</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Organize rasters into a named list</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>rasters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"2017"</span> <span class="ot">=</span> LULC_LIBERIA_2017,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>                <span class="st">"2023"</span> <span class="ot">=</span> LULC_LIBERIA_2023)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute land cover summary</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>land_cover_summary <span class="ot">&lt;-</span> <span class="fu">compute_land_cover_summary</span>(country_merc, rasters, pixel_area_ha)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(land_cover_summary, <span class="st">"./data/tables/land_cover_country_io.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>land_cover_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/covariates/places_poly_county.shp"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>jurisdiction_merc <span class="ot">=</span> counties <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  name <span class="sc">==</span> <span class="st">"Grand Cape Mount County"</span> <span class="sc">|</span> name <span class="sc">==</span> <span class="st">"Gharpolu County"</span> ) <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">project</span>(<span class="st">"EPSG:3857"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>jurisdiction_merc<span class="sc">$</span>name <span class="ot">=</span> <span class="st">'Grand Cape Mount &amp; Gharpolu Counties'</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>voi <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(aoi, <span class="dv">3857</span>) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>country_merc <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(country, <span class="dv">3857</span>) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2017<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/IO_LULC_LIBERIA_2017.tif"</span>) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">crop</span>(country_merc, <span class="at">mask=</span>T)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2023<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/IO_LULC_LIBERIA_2023.tif"</span>) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">crop</span>(country_merc, <span class="at">mask=</span>T)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>code_dict <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">11</span>),  </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Water"</span>, <span class="st">"Forest"</span>, <span class="st">"Wetland"</span>, <span class="st">"Bareground"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Built"</span>, <span class="st">"Cropland"</span>, <span class="st">"Rangeland"</span>))</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_LIBERIA_2017) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_LIBERIA_2023) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>LULC_PROJECT_2017 <span class="ot">=</span> LULC_LIBERIA_2017 <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">crop</span>(voi, <span class="at">mask=</span>T)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>LULC_PROJECT_2023 <span class="ot">=</span> LULC_LIBERIA_2023 <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">crop</span>(voi, <span class="at">mask=</span>T)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>LULC_COUNTY_2017 <span class="ot">=</span> LULC_LIBERIA_2017 <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">crop</span>(jurisdiction_merc, <span class="at">mask=</span>T)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>LULC_COUNTY_2023 <span class="ot">=</span> LULC_LIBERIA_2023 <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">crop</span>(jurisdiction_merc, <span class="at">mask=</span>T)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>code_dict <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">11</span>),  </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Water"</span>, <span class="st">"Forest"</span>, <span class="st">"Wetland"</span>, <span class="st">"Bareground"</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Built"</span>, <span class="st">"Cropland"</span>, <span class="st">"Rangeland"</span>))</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_COUNTY_2017) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_COUNTY_2023) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_PROJECT_2017) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_PROJECT_2023) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>compute_land_cover_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(jurisdiction_merc, rasters, pixel_area) {</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (terra<span class="sc">::</span><span class="fu">nrow</span>(jurisdiction_merc) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"The provided SpatVector jurisdiction is empty."</span>)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (region <span class="cf">in</span> <span class="fu">unique</span>(jurisdiction_merc<span class="sc">$</span>name)) {</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(rasters)) {</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>      cropped_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        rasters[[year]],</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        jurisdiction_merc[jurisdiction_merc<span class="sc">$</span>name <span class="sc">==</span> region, ],</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">mask =</span> <span class="cn">TRUE</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (terra<span class="sc">::</span><span class="fu">ncell</span>(cropped_raster) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Cropped raster for"</span>, region, year, <span class="st">"is empty. Skipping."</span>))</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>      freq <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">freq</span>(cropped_raster)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>area_ha <span class="ot">&lt;-</span> freq<span class="sc">$</span>count <span class="sc">*</span> pixel_area</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>percentage <span class="ot">&lt;-</span> (freq<span class="sc">$</span>area_ha <span class="sc">/</span> <span class="fu">sum</span>(freq<span class="sc">$</span>area_ha)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>region <span class="ot">&lt;-</span> region</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>      freq<span class="sc">$</span>year <span class="ot">&lt;-</span> year</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>      results[[<span class="fu">paste</span>(region, year, <span class="at">sep =</span> <span class="st">"_"</span>)]] <span class="ot">&lt;-</span> freq</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">do.call</span>(rbind, results))</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Organize rasters into a named list</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>rasters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2017"</span> <span class="ot">=</span> LULC_COUNTY_2017,</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2023"</span> <span class="ot">=</span> LULC_COUNTY_2023</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute land cover summary</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>land_cover_summary <span class="ot">&lt;-</span> <span class="fu">compute_land_cover_summary</span>(jurisdiction_merc, rasters, pixel_area_ha)</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(land_cover_summary, <span class="st">"./data/tables/land_cover_county_io.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>land_cover_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>land_cover_summary<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">factor</span>(land_cover_summary<span class="sc">$</span>value,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Forest"</span>, <span class="st">"Water"</span>, <span class="st">"Rangeland"</span>, <span class="st">"Built"</span>, <span class="st">"Cropland"</span>, <span class="st">"Bareground"</span>, <span class="st">"Wetland"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(land_cover_summary, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> percentage, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">width =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(percentage, <span class="dv">1</span>), <span class="st">"%"</span>)),  </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="fl">2.5</span>,  <span class="co"># Smaller text size</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.overlaps =</span> <span class="cn">Inf</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">box.padding =</span> <span class="fl">0.3</span>,  </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">point.padding =</span> <span class="fl">0.2</span>,  </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">segment.size =</span> <span class="fl">0.2</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Land cover change in Grand Cape Mount &amp; Gharpolu counties"</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Proportion (%)"</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="cn">NULL</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(land_cover_summary, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> percentage, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">width =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(percentage, <span class="dv">1</span>), <span class="st">"%"</span>)),  </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.3</span>,  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">point.padding =</span> <span class="fl">0.2</span>,  </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="st">"x"</span>,  <span class="co"># Adjust text to move horizontally</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="cn">Inf</span>  </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>  <span class="co"># Flip the chart</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Land cover change of project jurisdictions, 2017-2023"</span>, </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion (%)"</span>, </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Land Cover Class"</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>`mask_gola = terra::rast(“./data/BINARY/mask_gola.tif”) mask_tong = terra::rast(“./data/BINARY/mask_tong.tif”) mask_norm = terra::rast(“./data/BINARY/mask_norm.tif”) mask_project = terra::rast(“./data/BINARY/mask_project.tif”) mask_gola=terra::resample(mask_gola, LULC_PROJECT_2014) mask_tong=terra::resample(mask_tong, LULC_PROJECT_2014) mask_norm=terra::resample(mask_norm, LULC_PROJECT_2014) mask_project=terra::resample(mask_project, LULC_PROJECT_2014)</p>
</section>
<section id="forest-area" class="level4">
<h4 class="anchored" data-anchor-id="forest-area">Forest area</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/covariates/places_poly_county.shp"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>jurisdiction <span class="ot">=</span> counties <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Grand Cape Mount County"</span> <span class="sc">|</span> name <span class="sc">==</span> <span class="st">"Gharpolu County"</span> )</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>jurisdiction<span class="sc">$</span>name <span class="ot">=</span> <span class="st">'Grand Cape Mount &amp; Gharpolu Counties'</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(jurisdiction) <span class="sc">+</span> tmap<span class="sc">::</span><span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="fl">1.2</span>, <span class="at">col=</span><span class="st">"green"</span>) <span class="sc">+</span> tmap<span class="sc">::</span><span class="fu">tm_text</span>(<span class="st">"name"</span>, <span class="at">col=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="fl">0.9</span>) </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># project for hectares</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2014 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">project</span>(LULC_LIBERIA_2014, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2019 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">project</span>(LULC_LIBERIA_2019, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2024 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">project</span>(LULC_LIBERIA_2024, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Forest binary maps</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>forest_class <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>forest_2014 <span class="ot">&lt;-</span> LULC_LIBERIA_2014 <span class="sc">==</span> forest_class</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>forest_2019 <span class="ot">&lt;-</span> LULC_LIBERIA_2019 <span class="sc">==</span> forest_class</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>forest_2024 <span class="ot">&lt;-</span> LULC_LIBERIA_2024 <span class="sc">==</span> forest_class</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Forest loss maps</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2019_gross <span class="ot">&lt;-</span> forest_2014 <span class="sc">&amp;</span> <span class="sc">!</span>forest_2019</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>forest_loss_2019_2024_gross <span class="ot">&lt;-</span> forest_2019 <span class="sc">&amp;</span> <span class="sc">!</span>forest_2024</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>forest_gain_2014_2019_gross <span class="ot">&lt;-</span> <span class="sc">!</span>forest_2014 <span class="sc">&amp;</span> forest_2019</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>forest_gain_2019_2024_gross <span class="ot">&lt;-</span> <span class="sc">!</span>forest_2019 <span class="sc">&amp;</span> forest_2024</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2019 <span class="ot">&lt;-</span> forest_loss_2014_2019_gross <span class="sc">&amp;</span> <span class="sc">!</span>forest_gain_2014_2019_gross</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>forest_loss_2019_2024 <span class="ot">&lt;-</span> forest_loss_2019_2024_gross <span class="sc">&amp;</span> <span class="sc">!</span>forest_gain_2019_2024_gross</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Write to disk</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(forest_2014, <span class="st">"./data/BINARY/forest_2014.tif"</span>,<span class="at">overwrite=</span>T)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(forest_2019, <span class="st">"./data/BINARY/forest_2019.tif"</span>,<span class="at">overwrite=</span>T)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(forest_2024, <span class="st">"./data/BINARY/forest_2024.tif"</span>,<span class="at">overwrite=</span>T)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(forest_loss_2014_2019, <span class="st">"./data/BINARY/forest_loss_2014_2019.tif"</span>,<span class="at">overwrite=</span>T)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(forest_loss_2019_2024, <span class="st">"./data/BINARY/forest_loss_2019_2024.tif"</span>,<span class="at">overwrite=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2014.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2019.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2024.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2014_2019.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2019_2024.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'forest_2014' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'forest_2019' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'forest_2024' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'forest_loss_2014_2019' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'forest_loss_2019_2024' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'forest_2014' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'forest_2019' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'forest_2024' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'forest_loss_2014_2019' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'forest_loss_2019_2024' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2014_gola.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2014_tong.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2014_norm.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2014_project.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2019_gola.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2019_tong.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2019_norm.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2019_project.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2024_gola.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2024_tong.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2024_norm.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_2024_project.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2014_2019_gola.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2014_2019_tong.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2014_2019_norm.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2014_2019_project.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2019_2024_gola.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2019_2024_tong.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2019_2024_norm.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2019_2024_project.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2014_2024_gola.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2014_2024_tong.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2014_2024_norm.tif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ./data/BINARY/forest_loss_2014_2024_project.tif</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total number of forest pixels for each year</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>resolution <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">res</span>(forest_2014)[<span class="dv">1</span>]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>forest_2014_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2014[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>forest_2019_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2019[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>forest_2024_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2024[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2019_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2014_2019[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>forest_loss_2019_2024_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2019_2024[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total forest area across Liberia in 2014:"</span>, forest_2014_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total forest area across Liberia in 2019:"</span>, forest_2019_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total forest area across Liberia in 2024:"</span>, forest_2024_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total forest Loss across Liberia (2014-2019):"</span>, forest_loss_2014_2019_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total forest Loss across Liberia (2019-2024):"</span>, forest_loss_2019_2024_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate forest area for each sub-region (in hectares) for all years</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>forest_2014<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/BINARY/forest_2014.tif"</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>resolution <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">res</span>(forest_2014)[<span class="dv">1</span>]</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>forest_2014_gola_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2014_gola[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>forest_2014_tong_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2014_tong[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>forest_2014_norm_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2014_norm[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>forest_2014_project_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2014_project[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>forest_2019_gola_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2019_gola[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>forest_2019_tong_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2019_tong[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>forest_2019_norm_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2019_norm[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>forest_2019_project_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2019_project[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>forest_2024_gola_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2024_gola[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>forest_2024_tong_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2024_tong[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>forest_2024_norm_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2024_norm[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>forest_2024_project_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_2024_project[], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> resolution<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate forest loss for each sub-region (in hectares) for all periods</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2019_gola_estimate<span class="ot">&lt;-</span><span class="fu">sum</span>(forest_loss_2014_2019_gola[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2019_tong_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2014_2019_tong[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2019_norm_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2014_2019_norm[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2019_project_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2014_2019_project[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>forest_loss_2019_2024_gola_estimate<span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2019_2024_gola[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>forest_loss_2019_2024_tong_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2019_2024_tong[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>forest_loss_2019_2024_norm_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2019_2024_norm[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>forest_loss_2019_2024_project_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2019_2024_project[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2024_gola_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2014_2024_gola[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2024_tong_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2014_2024_tong[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2024_norm_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2014_2024_norm[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2024_project_estimate <span class="ot">&lt;-</span> <span class="fu">sum</span>(forest_loss_2014_2024_project[],<span class="at">na.rm=</span>T)<span class="sc">*</span>resolution<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the forest area and loss estimates for each region and year</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Gola NP (2014):"</span>, forest_2014_gola_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Tonglay (2014):"</span>, forest_2014_norm_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Norman (2014):"</span>, forest_2014_tong_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Project (2014):"</span>, forest_2014_project_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Gola NP (2019):"</span>, forest_2019_gola_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Tonglay (2019):"</span>, forest_2019_tong_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Norman (2019):"</span>, forest_2019_norm_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Project (2019):"</span>, forest_2019_project_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Gola NP (2024):"</span>, forest_2024_gola_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Tonglay (2024):"</span>, forest_2024_tong_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Norman (2024):"</span>, forest_2024_norm_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Area in Project (2024):"</span>, forest_2024_project_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Gola NP (2014-2019):"</span>, forest_loss_2014_2019_gola_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Tonglay (2014-2019):"</span>, forest_loss_2014_2019_tong_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Norman (2014-2019):"</span>, forest_loss_2014_2019_norm_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Project (2014-2019):"</span>, forest_loss_2014_2019_project_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Gola NP (2019-2024):"</span>, forest_loss_2019_2024_gola_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Tonglay (2019-2024):"</span>, forest_loss_2019_2024_tong_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Norman (2019-2024):"</span>, forest_loss_2019_2024_norm_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Project (2019-2024):"</span>, forest_loss_2019_2024_project_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Gola NP (2014-2024):"</span>, forest_loss_2014_2024_gola_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Tonglay (2014-2024):"</span>, forest_loss_2014_2024_tong_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Norman (2014-2024):"</span>, forest_loss_2014_2024_norm_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Forest Loss in Project (2014-2024):"</span>, forest_loss_2014_2024_project_estimate, <span class="st">"hectares</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="deforestation-allocation" class="level2">
<h2 class="anchored" data-anchor-id="deforestation-allocation">Deforestation allocation</h2>
<p>The following spatial covariates were imported and processed as potential drivers of deforestation risk. Covariates were merged between sociodemographic and geographic datasets surrounding the project area and national level datasets beyond the project area in order to enable jurisdictions analysis.</p>
<p>Further updates are expected to these spatial coveriates pending delivery of proprietary data from the client. We also recommend that these mapping and risk assessments be revised or replaced prior to submission of PD, and following the release of Liberia’s Activity Data and jurisdictional deforestation risk maps <a href="https://verra.org/methodologies-main/allocated-deforestation-risk-maps-timetable">planned by Verra in Q3 of 2025</a>. For collective review, final covariates were visualized in the following interactive map.</p>
<section id="demography-topography" class="level4">
<h4 class="anchored" data-anchor-id="demography-topography">Demography &amp; topography</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="do">##### Covariate wrangling#####</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="do">##### Download sociodemography</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>pop_url <span class="ot">&lt;-</span> <span class="st">"https://jeodpp.jrc.ec.europa.eu/ftp/jrc-opendata/GHSL/GHS_POP_GLOBE_R2023A/GHS_POP_E2025_GLOBE_R2023A_54009_1000/V1-0/GHS_POP_E2025_GLOBE_R2023A_54009_1000_V1_0.zip"</span> </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>osm_url <span class="ot">&lt;-</span> <span class="st">"https://download.geofabrik.de/africa/liberia-latest-free.shp.zip"</span> </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="do">##### Built Environment</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>places_points_project<span class="ot">=</span>sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/Winrock_GIS/Communities_8km.shp"</span>)<span class="sc">|&gt;</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass)<span class="sc">|&gt;</span><span class="fu">rename</span>(<span class="at">place=</span>fclass)<span class="sc">|&gt;</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">place =</span> <span class="fu">as.factor</span>(place)) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name))</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>places_points_liberia_1<span class="ot">=</span>sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/liberia_point.shp"</span>)<span class="sc">|&gt;</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)<span class="sc">|&gt;</span>sf<span class="sc">::</span><span class="fu">st_intersection</span>(country)<span class="sc">|&gt;</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,place)<span class="sc">|&gt;</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">place =</span> <span class="fu">as.factor</span>(place)) <span class="sc">|&gt;</span> </span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name))</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>places_points_liberia_2 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/gis_osm_places_free_1.shp"</span>)<span class="sc">|&gt;</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)<span class="sc">|&gt;</span>sf<span class="sc">::</span><span class="fu">st_intersection</span>(country)<span class="sc">|&gt;</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass)<span class="sc">|&gt;</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">place=</span>fclass)<span class="sc">|&gt;</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">place =</span> <span class="fu">as.factor</span>(place))<span class="sc">|&gt;</span> </span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name))</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>places_worship <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/gis_osm_pofw_free_1.shp"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(country)<span class="sc">|&gt;</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass)<span class="sc">|&gt;</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">creed=</span>fclass) <span class="sc">|&gt;</span> </span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">creed=</span><span class="fu">as.factor</span>(creed))  <span class="sc">|&gt;</span> </span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name)) <span class="sc">|&gt;</span> </span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>places_points <span class="ot">&lt;-</span> places_points_project <span class="sc">%&gt;%</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(places_points_liberia_1,places_points_liberia_2, places_worship) <span class="sc">%&gt;%</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="sc">-</span>geometry)) <span class="sc">%&gt;%</span></span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_union</span>(geometry), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>places_points <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_cast</span>(places_points, <span class="st">"POINT"</span>)</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(places_points, <span class="st">"./data/covariates/places_points.shp"</span>, <span class="at">delete_dsn=</span>T)</span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a><span class="do">##### Administrative Boundaries</span></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>places_poly_liberia <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/liberia_poly.shp"</span>)<span class="sc">|&gt;</span><span class="fu">st_cast</span>(<span class="st">"GEOMETRY"</span>)</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>places_poly_county <span class="ot">&lt;-</span> places_poly_liberia[<span class="fu">st_geometry_type</span>(places_poly_liberia) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"POLYGON"</span>, <span class="st">"MULTIPOLYGON"</span>), ] <span class="sc">|&gt;</span></span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(country)<span class="sc">|&gt;</span></span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,place,admin_leve)<span class="sc">|&gt;</span></span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">place =</span> <span class="fu">as.factor</span>(place)) <span class="sc">|&gt;</span> </span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name)) <span class="sc">|&gt;</span></span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">admin_level =</span> admin_leve) <span class="sc">|&gt;</span></span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(admin_level <span class="sc">==</span> <span class="st">"4"</span>) </span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a>places_poly_county <span class="ot">&lt;-</span> places_poly_county[<span class="fu">st_geometry_type</span>(places_poly_county) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"POLYGON"</span>, <span class="st">"MULTIPOLYGON"</span>), ] <span class="sc">|&gt;</span></span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(places_poly_county, <span class="st">"./data/covariates/places_poly_county.shp"</span>, <span class="at">delete_dsn=</span>T)  </span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a>places_poly_district <span class="ot">&lt;-</span> places_poly_liberia[<span class="fu">st_geometry_type</span>(places_poly_liberia) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"POLYGON"</span>, <span class="st">"MULTIPOLYGON"</span>), ] <span class="sc">|&gt;</span></span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)<span class="sc">|&gt;</span>sf<span class="sc">::</span><span class="fu">st_intersection</span>(country)<span class="sc">|&gt;</span></span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,place,admin_leve)<span class="sc">|&gt;</span></span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">place =</span> <span class="fu">as.factor</span>(place)) <span class="sc">|&gt;</span> </span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name)) <span class="sc">|&gt;</span></span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">admin_level =</span> admin_leve) <span class="sc">|&gt;</span></span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(admin_level <span class="sc">==</span> <span class="st">"6"</span>)</span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a>places_poly_district <span class="ot">&lt;-</span> places_poly_district[<span class="fu">st_geometry_type</span>(places_poly_district) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"POLYGON"</span>, <span class="st">"MULTIPOLYGON"</span>), ] <span class="sc">|&gt;</span></span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(places_poly_district, <span class="st">"./data/covariates/places_poly_district.shp"</span>, <span class="at">delete_dsn=</span>T)  </span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a>buildings_private <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/gis_osm_buildings_a_free_1.shp"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(country) <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_simplify</span>(<span class="at">preserveTopology =</span> <span class="cn">FALSE</span>, <span class="at">dTolerance =</span> <span class="dv">1000</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass) <span class="sc">|&gt;</span></span>
<span id="cb58-69"><a href="#cb58-69" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">place =</span> fclass) <span class="sc">|&gt;</span> </span>
<span id="cb58-70"><a href="#cb58-70" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">place =</span> <span class="fu">as.factor</span>(place))<span class="sc">|&gt;</span> </span>
<span id="cb58-71"><a href="#cb58-71" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name)) <span class="sc">|&gt;</span></span>
<span id="cb58-72"><a href="#cb58-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>) </span>
<span id="cb58-73"><a href="#cb58-73" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(buildings_private, <span class="st">"./data/covariates/buildings_private.shp"</span>, <span class="at">delete_dsn=</span>T)</span>
<span id="cb58-74"><a href="#cb58-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-75"><a href="#cb58-75" aria-hidden="true" tabindex="-1"></a>buildings_public <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/gis_osm_pois_a_free_1.shp"</span>)  <span class="sc">|&gt;</span></span>
<span id="cb58-76"><a href="#cb58-76" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(country) <span class="sc">|&gt;</span></span>
<span id="cb58-77"><a href="#cb58-77" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass) <span class="sc">|&gt;</span></span>
<span id="cb58-78"><a href="#cb58-78" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">place =</span> fclass) <span class="sc">|&gt;</span> </span>
<span id="cb58-79"><a href="#cb58-79" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">place =</span> <span class="fu">as.factor</span>(place))<span class="sc">|&gt;</span> </span>
<span id="cb58-80"><a href="#cb58-80" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name)) <span class="sc">|&gt;</span></span>
<span id="cb58-81"><a href="#cb58-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>) </span>
<span id="cb58-82"><a href="#cb58-82" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(buildings_public, <span class="st">"./data/covariates/buildings_public.shp"</span>, <span class="at">delete_dsn=</span>T)</span>
<span id="cb58-83"><a href="#cb58-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-84"><a href="#cb58-84" aria-hidden="true" tabindex="-1"></a>buildings_merged <span class="ot">&lt;-</span> buildings_private <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>(buildings_public) <span class="sc">|&gt;</span></span>
<span id="cb58-85"><a href="#cb58-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="sc">-</span>geometry)) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_union</span>(geometry), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb58-86"><a href="#cb58-86" aria-hidden="true" tabindex="-1"></a>buildings_merged <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_cast</span>(buildings_merged, <span class="st">"POLYGON"</span>)</span>
<span id="cb58-87"><a href="#cb58-87" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(buildings_merged, <span class="st">"./data/covariates/buildings.shp"</span>, <span class="at">delete_dsn=</span>T)</span>
<span id="cb58-88"><a href="#cb58-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-89"><a href="#cb58-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-90"><a href="#cb58-90" aria-hidden="true" tabindex="-1"></a><span class="do">###### Waterways </span></span>
<span id="cb58-91"><a href="#cb58-91" aria-hidden="true" tabindex="-1"></a>waterways_liberia <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/gis_osm_waterways_free_1.shp"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-92"><a href="#cb58-92" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(bbox_country) <span class="sc">|&gt;</span></span>
<span id="cb58-93"><a href="#cb58-93" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass) <span class="sc">|&gt;</span></span>
<span id="cb58-94"><a href="#cb58-94" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fclass =</span> <span class="fu">as.factor</span>(fclass))<span class="sc">|&gt;</span> </span>
<span id="cb58-95"><a href="#cb58-95" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name))</span>
<span id="cb58-96"><a href="#cb58-96" aria-hidden="true" tabindex="-1"></a>waterways_liberia <span class="ot">&lt;-</span> waterways_liberia[<span class="fu">st_geometry_type</span>(waterways_liberia) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"LINESTRING"</span>, <span class="st">"MULTILINESTRING"</span>), ] <span class="sc">|&gt;</span></span>
<span id="cb58-97"><a href="#cb58-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>) </span>
<span id="cb58-98"><a href="#cb58-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-99"><a href="#cb58-99" aria-hidden="true" tabindex="-1"></a>waterways_project <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/Winrock_GIS/PA_river.shp"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-100"><a href="#cb58-100" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(bbox_country) <span class="sc">|&gt;</span></span>
<span id="cb58-101"><a href="#cb58-101" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass) <span class="sc">|&gt;</span></span>
<span id="cb58-102"><a href="#cb58-102" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fclass =</span> <span class="fu">as.factor</span>(fclass))<span class="sc">|&gt;</span> </span>
<span id="cb58-103"><a href="#cb58-103" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name))</span>
<span id="cb58-104"><a href="#cb58-104" aria-hidden="true" tabindex="-1"></a>waterways_project <span class="ot">&lt;-</span> waterways_project[<span class="fu">st_geometry_type</span>(waterways_project) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"LINESTRING"</span>, <span class="st">"MULTILINESTRING"</span>), ] <span class="sc">|&gt;</span></span>
<span id="cb58-105"><a href="#cb58-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>) </span>
<span id="cb58-106"><a href="#cb58-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-107"><a href="#cb58-107" aria-hidden="true" tabindex="-1"></a>waterways_hydrosheds <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"/Users/seamus/repos/rspb-redd-risk-new/data/hydro/HydroRIVERS_v10_af.shp"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb58-108"><a href="#cb58-108" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(bbox_country)</span>
<span id="cb58-109"><a href="#cb58-109" aria-hidden="true" tabindex="-1"></a>waterways_hydrosheds <span class="ot">&lt;-</span> waterways_hydrosheds[<span class="fu">st_geometry_type</span>(waterways_hydrosheds) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"LINESTRING"</span>, <span class="st">"MULTILINESTRING"</span>), ] <span class="sc">|&gt;</span></span>
<span id="cb58-110"><a href="#cb58-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>) </span>
<span id="cb58-111"><a href="#cb58-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-112"><a href="#cb58-112" aria-hidden="true" tabindex="-1"></a>waterways_merged <span class="ot">&lt;-</span> waterways_liberia <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>(waterways_project) <span class="sc">|&gt;</span></span>
<span id="cb58-113"><a href="#cb58-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="sc">-</span>geometry)) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_union</span>(geometry), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb58-114"><a href="#cb58-114" aria-hidden="true" tabindex="-1"></a>waterways_merged <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_cast</span>(waterways_merged, <span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb58-115"><a href="#cb58-115" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(waterways_merged, <span class="st">"./data/covariates/waterways_merged.shp"</span>, <span class="at">delete_dsn=</span>T)</span>
<span id="cb58-116"><a href="#cb58-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-117"><a href="#cb58-117" aria-hidden="true" tabindex="-1"></a>waterbodies_collection <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/gis_osm_water_a_free_1.shp"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb58-118"><a href="#cb58-118" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(bbox_country) <span class="sc">|&gt;</span></span>
<span id="cb58-119"><a href="#cb58-119" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass) <span class="sc">|&gt;</span></span>
<span id="cb58-120"><a href="#cb58-120" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fclass =</span> <span class="fu">as.factor</span>(fclass))<span class="sc">|&gt;</span> </span>
<span id="cb58-121"><a href="#cb58-121" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name))</span>
<span id="cb58-122"><a href="#cb58-122" aria-hidden="true" tabindex="-1"></a>waterbodies_poly <span class="ot">&lt;-</span> waterbodies_collection[<span class="fu">st_geometry_type</span>(waterbodies_collection) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"POLYGON"</span>, <span class="st">"MULTIPOLYGON"</span>), ] </span>
<span id="cb58-123"><a href="#cb58-123" aria-hidden="true" tabindex="-1"></a>waterbodies_lines <span class="ot">&lt;-</span> waterbodies_collection[<span class="fu">st_geometry_type</span>(waterbodies_collection) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"LINESTRING"</span>, <span class="st">"MULTILINESTRING"</span>), ] </span>
<span id="cb58-124"><a href="#cb58-124" aria-hidden="true" tabindex="-1"></a>waterbodies_poly_lines <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_boundary</span>(waterbodies_poly)</span>
<span id="cb58-125"><a href="#cb58-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-126"><a href="#cb58-126" aria-hidden="true" tabindex="-1"></a>waterbodies_waterways_merged <span class="ot">&lt;-</span> waterbodies_lines <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>(waterbodies_poly_lines, waterways_merged) <span class="sc">|&gt;</span></span>
<span id="cb58-127"><a href="#cb58-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="sc">-</span>geometry)) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_union</span>(geometry), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb58-128"><a href="#cb58-128" aria-hidden="true" tabindex="-1"></a>waterbodies_waterways_merged <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_cast</span>(waterbodies_waterways_merged, <span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb58-129"><a href="#cb58-129" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(waterbodies_waterways_merged, <span class="st">"./data/covariates/waterbodies_waterways_merged.shp"</span>, <span class="at">delete_dsn=</span>T)</span>
<span id="cb58-130"><a href="#cb58-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-131"><a href="#cb58-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-132"><a href="#cb58-132" aria-hidden="true" tabindex="-1"></a><span class="do">###### Transport &amp; Infrastructure</span></span>
<span id="cb58-133"><a href="#cb58-133" aria-hidden="true" tabindex="-1"></a>transport<span class="ot">=</span>sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/gis_osm_transport_a_free_1.shp"</span>)<span class="sc">|&gt;</span> <span class="fu">st_boundary</span>()<span class="sc">|&gt;</span></span>
<span id="cb58-134"><a href="#cb58-134" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(bbox_country_2) <span class="sc">|&gt;</span></span>
<span id="cb58-135"><a href="#cb58-135" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass) <span class="sc">|&gt;</span></span>
<span id="cb58-136"><a href="#cb58-136" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fclass =</span> <span class="fu">as.factor</span>(fclass))<span class="sc">|&gt;</span> </span>
<span id="cb58-137"><a href="#cb58-137" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name))</span>
<span id="cb58-138"><a href="#cb58-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-139"><a href="#cb58-139" aria-hidden="true" tabindex="-1"></a>railways <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/gis_osm_railways_free_1.shp"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-140"><a href="#cb58-140" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(bbox_country_2) <span class="sc">|&gt;</span></span>
<span id="cb58-141"><a href="#cb58-141" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass) <span class="sc">|&gt;</span></span>
<span id="cb58-142"><a href="#cb58-142" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fclass =</span> <span class="fu">as.factor</span>(fclass))<span class="sc">|&gt;</span> </span>
<span id="cb58-143"><a href="#cb58-143" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name))</span>
<span id="cb58-144"><a href="#cb58-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-145"><a href="#cb58-145" aria-hidden="true" tabindex="-1"></a>roads_liberia <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/gis_osm_roads_free_1.shp"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-146"><a href="#cb58-146" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(bbox_country_2) <span class="sc">|&gt;</span></span>
<span id="cb58-147"><a href="#cb58-147" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass) <span class="sc">|&gt;</span></span>
<span id="cb58-148"><a href="#cb58-148" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fclass =</span> <span class="fu">as.factor</span>(fclass))<span class="sc">|&gt;</span> </span>
<span id="cb58-149"><a href="#cb58-149" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name))</span>
<span id="cb58-150"><a href="#cb58-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-151"><a href="#cb58-151" aria-hidden="true" tabindex="-1"></a>roads_project <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/Winrock_GIS/PA_roads.shp"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-152"><a href="#cb58-152" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(bbox_country_1) <span class="sc">|&gt;</span></span>
<span id="cb58-153"><a href="#cb58-153" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,fclass) <span class="sc">|&gt;</span></span>
<span id="cb58-154"><a href="#cb58-154" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fclass =</span> <span class="fu">as.factor</span>(fclass))<span class="sc">|&gt;</span> </span>
<span id="cb58-155"><a href="#cb58-155" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name))</span>
<span id="cb58-156"><a href="#cb58-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-157"><a href="#cb58-157" aria-hidden="true" tabindex="-1"></a>roads_rail_transport_merged <span class="ot">&lt;-</span> transport <span class="sc">|&gt;</span> </span>
<span id="cb58-158"><a href="#cb58-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(railways, roads_liberia, roads_project) <span class="sc">|&gt;</span></span>
<span id="cb58-159"><a href="#cb58-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="sc">-</span>geometry)) <span class="sc">|&gt;</span> </span>
<span id="cb58-160"><a href="#cb58-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_union</span>(geometry), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb58-161"><a href="#cb58-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-162"><a href="#cb58-162" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_cast</span>(roads_rail_transport_merged, <span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb58-163"><a href="#cb58-163" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(roads, <span class="st">"./data/covariates/roads_rail_transport_merged.shp"</span>, <span class="at">delete_dsn=</span>T)</span>
<span id="cb58-164"><a href="#cb58-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-165"><a href="#cb58-165" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> roads <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>(roads_sle) <span class="sc">|&gt;</span> <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="sc">-</span>geometry)) <span class="sc">|&gt;</span> </span>
<span id="cb58-166"><a href="#cb58-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_union</span>(geometry), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb58-167"><a href="#cb58-167" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(roads, <span class="st">"./data/covariates/roads_intl.shp"</span>, <span class="at">delete_dsn=</span>T)</span>
<span id="cb58-168"><a href="#cb58-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-169"><a href="#cb58-169" aria-hidden="true" tabindex="-1"></a>roads_lib <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/covariates/roads_intl.shp"</span>) <span class="sc">|&gt;</span> <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb58-170"><a href="#cb58-170" aria-hidden="true" tabindex="-1"></a>roads_sle <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/liberia-osmdata/hotosm_sle_roads_lines_shp.shp"</span>) <span class="sc">|&gt;</span><span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb58-171"><a href="#cb58-171" aria-hidden="true" tabindex="-1"></a>roads_lib   <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_intersection</span>(roads_lib, bbox_aoi_2)<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">select</span>(name)</span>
<span id="cb58-172"><a href="#cb58-172" aria-hidden="true" tabindex="-1"></a>roads_sle   <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_intersection</span>(roads_sle, bbox_aoi_2)<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">select</span>(name)</span>
<span id="cb58-173"><a href="#cb58-173" aria-hidden="true" tabindex="-1"></a>roads   <span class="ot">=</span> <span class="fu">rbind</span>(roads_lib, roads_sle)</span>
<span id="cb58-174"><a href="#cb58-174" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(roads, <span class="st">"./data/ROADS/roads.shp"</span>, <span class="at">delete_layer=</span>T)</span>
<span id="cb58-175"><a href="#cb58-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-176"><a href="#cb58-176" aria-hidden="true" tabindex="-1"></a>roads_lib <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_intersection</span>(roads_lib, bbox_aoi_2)</span>
<span id="cb58-177"><a href="#cb58-177" aria-hidden="true" tabindex="-1"></a>roads_sle <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_intersection</span>(roads_sle, bbox_aoi_2)</span>
<span id="cb58-178"><a href="#cb58-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-179"><a href="#cb58-179" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(roads_clip) <span class="sc">+</span> tmap<span class="sc">::</span><span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"orange"</span>, <span class="at">lwd=</span><span class="fl">0.6</span>) <span class="sc">+</span> tmap<span class="sc">::</span><span class="fu">tm_shape</span>(aoi) <span class="sc">+</span> <span class="fu">tm_borders</span>(<span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="fl">1.7</span>)</span>
<span id="cb58-180"><a href="#cb58-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-181"><a href="#cb58-181" aria-hidden="true" tabindex="-1"></a><span class="do">##### Slope / Elevation</span></span>
<span id="cb58-182"><a href="#cb58-182" aria-hidden="true" tabindex="-1"></a>dem   <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">subset</span>(STACK, <span class="st">"DEM"</span>)</span>
<span id="cb58-183"><a href="#cb58-183" aria-hidden="true" tabindex="-1"></a>slope_tangent <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">terrain</span>(</span>
<span id="cb58-184"><a href="#cb58-184" aria-hidden="true" tabindex="-1"></a>  dem, <span class="at">opt=</span><span class="st">"slope"</span>,<span class="at">unit=</span><span class="st">"tangent"</span>,<span class="at">neighbors=</span><span class="dv">8</span>,<span class="at">filename=</span><span class="st">"./data/DEM/slope_tangent.tif"</span>)</span>
<span id="cb58-185"><a href="#cb58-185" aria-hidden="true" tabindex="-1"></a>slope_tangent <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/DEM/slope_tangent.tif"</span>)</span>
<span id="cb58-186"><a href="#cb58-186" aria-hidden="true" tabindex="-1"></a>slope_percent <span class="ot">=</span> slope_tangent <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb58-187"><a href="#cb58-187" aria-hidden="true" tabindex="-1"></a>slope_percent <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">clamp</span>(slope_percent, <span class="dv">0</span>, <span class="dv">100</span>) </span>
<span id="cb58-188"><a href="#cb58-188" aria-hidden="true" tabindex="-1"></a>slope_percent <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">raster</span>(slope_percent)</span>
<span id="cb58-189"><a href="#cb58-189" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(slope_percent, <span class="st">"./data/covariates/slope_percent.tif"</span>)</span>
<span id="cb58-190"><a href="#cb58-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-191"><a href="#cb58-191" aria-hidden="true" tabindex="-1"></a>urban <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">mask</span>(LULC_LIBERIA_2024, LULC_LIBERIA_2024 <span class="sc">==</span> <span class="dv">4</span>, <span class="at">maskvalue =</span> <span class="cn">FALSE</span>)</span>
<span id="cb58-192"><a href="#cb58-192" aria-hidden="true" tabindex="-1"></a>urban <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">raster</span>(urban)</span>
<span id="cb58-193"><a href="#cb58-193" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(urban, <span class="st">"./data/covariates/urban.tif"</span>, <span class="at">overwrite=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="annualized-deforestation" class="level4">
<h4 class="anchored" data-anchor-id="annualized-deforestation">Annualized deforestation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign zones</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>zones_sf <span class="ot">=</span> counties <span class="sc">|&gt;</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="st">"EPSG:32629"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>zones_sf<span class="sc">$</span>zone_id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(zones_sf)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>zones_sv <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">vect</span>(zones_sf)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate zonal annualization by jurisdiction</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>forest_2024 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/BINARY/forest_2024.tif"</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2019 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/BINARY/forest_loss_2014_2019.tif"</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>forest_loss_2019_2024 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/BINARY/forest_loss_2019_2024.tif"</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>forest_loss_2014_2024 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/BINARY/forest_loss_2014_2024.tif"</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>pixel_area_ha <span class="ot">&lt;-</span> <span class="fl">0.088914</span>  <span class="co"># 29.80124 x 29.80124 m² converted to hectares</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>zonal_2014_2019 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(forest_loss_2014_2019,zones_sv,<span class="at">fun=</span>sum,<span class="at">na.rm=</span>T)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>zonal_2019_2024 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(forest_loss_2019_2024,zones_sv,<span class="at">fun=</span>sum,<span class="at">na.rm=</span>T)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(zonal_2014_2019) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"zone_id"</span>, <span class="st">"loss_2014_2019"</span>)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(zonal_2019_2024) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"zone_id"</span>, <span class="st">"loss_2019_2024"</span>)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>zonal_2014_2019<span class="sc">$</span>loss_2014_2019 <span class="ot">&lt;-</span> zonal_2014_2019<span class="sc">$</span>loss_2014_2019 <span class="sc">*</span> pixel_area_ha</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>zonal_2019_2024<span class="sc">$</span>loss_2019_2024 <span class="ot">&lt;-</span> zonal_2019_2024<span class="sc">$</span>loss_2019_2024 <span class="sc">*</span> pixel_area_ha</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge baseline years</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>zonal_stats <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>  zonal_2014_2019,      <span class="co"># e.g. (zone_id, loss_2014_2019)</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>  zonal_2019_2024,      <span class="co"># e.g. (zone_id, loss_2019_2024)</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"zone_id"</span>,       <span class="co"># Common ID column</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">all =</span> <span class="cn">TRUE</span>            <span class="co"># Keep all rows if zones differ</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Annualize 10-year total &amp; rejoin to sf object</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>zonal_stats<span class="sc">$</span>loss_10yr <span class="ot">&lt;-</span> zonal_stats<span class="sc">$</span>loss_2014_2019 <span class="sc">+</span> zonal_stats<span class="sc">$</span>loss_2019_2024</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>zonal_stats<span class="sc">$</span>annual_loss_10yr <span class="ot">&lt;-</span> zonal_stats<span class="sc">$</span>loss_10yr <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>zones_sf <span class="ot">&lt;-</span> <span class="fu">merge</span>(zones_sf, zonal_stats, <span class="at">by=</span><span class="st">"zone_id"</span>, <span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(zones_sf[, <span class="fu">c</span>(<span class="st">"zone_id"</span>, <span class="st">"loss_2014_2019"</span>, <span class="st">"loss_2019_2024"</span>, </span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"loss_10yr"</span>, <span class="st">"annual_loss_10yr"</span>)])</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive 10-yr annualized raster</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>zones_sv <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">vect</span>(zones_sf)</span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>annual_loss_10yr_raster <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>  zones_sv,                  <span class="co"># polygon SpatVector</span></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>  forest_loss_2014_2019,     <span class="co"># template raster for resolution/extent</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">field =</span> <span class="st">"annual_loss_10yr"</span>) <span class="co"># the column to rasterize</span></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(annual_loss_10yr_raster) <span class="ot">&lt;-</span> (<span class="st">"annual_loss_10yr"</span>)</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(annual_loss_10yr_raster,<span class="st">"./data/BINARY/annual_loss_2014_2024_zonal.tif"</span>,<span class="at">overwrite=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distance-covariates" class="level4">
<h4 class="anchored" data-anchor-id="distance-covariates">Distance covariates</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive distance-to-edge raster </span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>forest_2024 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/BINARY/forest_2024.tif"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>forest_mask <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(forest_2024, <span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="cn">NA</span>)))</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>nonForest_mask <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(forest_2024, <span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">1</span>)))</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(forest_mask, <span class="st">"./data/BINARY/forest_mask.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(nonForest_mask, <span class="st">"./data/BINARY/nonForest_mask.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>forest_for_distance <span class="ot">&lt;-</span> forest_mask</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>forest_for_distance_raster <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">raster</span>(forest_for_distance) </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>distance_to_edge <span class="ot">&lt;-</span> <span class="fu">distance</span>(forest_for_distance_raster, <span class="at">filename=</span><span class="st">"./data/BINARY/distance_to_edge_unix.tif"</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive distance-to-feature rasters</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>template <span class="ot">&lt;-</span> forest_2024</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>roads_rast <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(<span class="fu">vect</span>(transport), template, <span class="at">field=</span><span class="dv">1</span>, <span class="at">background=</span><span class="dv">0</span>)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>roads_rast <span class="ot">&lt;-</span> <span class="fu">subst</span>(roads_rast, <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="cn">NA</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>distance_to_roads <span class="ot">&lt;-</span> <span class="fu">distance</span>(roads_rast)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(distance_to_roads, <span class="st">"./data/LULC/distance_to_roads.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>places_vect   <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./data/BINARY/places.shp"</span>) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>places_rast   <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(places_vect,template,<span class="at">field=</span><span class="dv">1</span>,<span class="at">background=</span><span class="dv">0</span>,<span class="at">touches=</span>T)</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>places_rast   <span class="ot">&lt;-</span> <span class="fu">subst</span>(places_rast, <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="cn">NA</span>)</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>distance_to_places<span class="ot">&lt;-</span> <span class="fu">distance</span>(places_rast)</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(distance_to_places, <span class="st">"./data/LULC/distance_to_places.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>waterways_rast<span class="ot">&lt;-</span><span class="fu">rasterize</span>(<span class="fu">vect</span>(waterways_rast), template, <span class="at">field=</span><span class="dv">1</span>, <span class="at">background=</span><span class="dv">0</span>)</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>waterways_rast<span class="ot">&lt;-</span><span class="fu">subst</span>(waterways_rast, <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="cn">NA</span>)</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>distance_to_waterways<span class="ot">&lt;-</span><span class="fu">distance</span>(waterways_rast)</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(distance_to_waterways, <span class="st">"./data/LULC/distance_to_waterways.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>urban_rast    <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">raster</span>(urban)</span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>urban_rast    <span class="ot">&lt;-</span> <span class="fu">subst</span>(urban_rast, <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="cn">NA</span>)</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>distance_to_urban <span class="ot">&lt;-</span> <span class="fu">distance</span>(urban_rast)</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(distance_to_urban, <span class="st">"./data/LULC/distance_to_urban.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize covariates for quicker computing</span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>normalize <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>  (x<span class="sc">-</span><span class="fu">global</span>(x,<span class="st">"min"</span>,<span class="at">na.rm=</span>T))<span class="sc">/</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">global</span>(x,<span class="st">"max"</span>,<span class="at">na.rm=</span>T) <span class="sc">-</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>       <span class="fu">global</span>(x, <span class="st">"min"</span>,<span class="at">na.rm=</span>T))}</span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>population<span class="ot">=</span> raster<span class="sc">::</span><span class="fu">raster</span>(population)</span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>population<span class="ot">=</span> <span class="fu">normalize_function</span>(population)</span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a>slope     <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">raster</span>(slope)</span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>slope     <span class="ot">=</span> <span class="fu">normalize_function</span>(slope)</span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a>distance_to_forest    <span class="ot">=</span> <span class="fu">normalize_function</span>(distance_to_forest)</span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a>distance_to_roads     <span class="ot">=</span> <span class="fu">normalize_function</span>(distance_to_roads)</span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a>distance_to_places    <span class="ot">=</span> <span class="fu">normalize_function</span>(distance_to_places)</span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a>distance_to_water     <span class="ot">=</span> <span class="fu">normalize_function</span>(distance_to_waterways)</span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a>distance_to_urban     <span class="ot">=</span> <span class="fu">normalize_function</span>(distance_to_urban)</span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a><span class="co"># invert all risk-producing covariates</span></span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a>distance_to_edge_inv <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> distance_to_forest</span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a>distance_to_roads_inv  <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> distance_to_roads</span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a>distance_to_places_inv <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> distance_to_places</span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a>distance_to_water_inv <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span>  distance_to_waterways</span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a>distance_to_urban_inv   <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> distance_to_urban</span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(distance_to_edge_inv, <span class="st">"./data/BINARY/distance_to_edge_inverted.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(distance_to_roads_inv, <span class="st">"./data/BINARY/distance_to_roads_inverted.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(distance_to_places_inv, <span class="st">"./data/BINARY/distance_to_places_inverted.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(distance_to_water_inv, <span class="st">"./data/BINARY/distance_to_water_inverted.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(distance_to_urban_inv, <span class="st">"./data/BINARY/distance_to_urban_inverted.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(slope_norm, <span class="st">"./data/BINARY/slope_norm.tif"</span>, <span class="at">overwrite=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="deforestation-risk" class="level4">
<h4 class="anchored" data-anchor-id="deforestation-risk">Deforestation risk</h4>
<p>Two methods were explored for weighting variables and creating a generalized deforestation risk index. We could consider developing a spatial risk model using the <code>spatstat</code> package or logistic regression, as has been cited in recent Verra guides. In addition, some of the heavy lifting with input formatting and data wrangling has already been completed.</p>
<p>However, spatial modelling has tended to produce challenges when fitting such large country-wide covariates. Moreover, these kinds of spatialy driven models tend to require longer training procedures due to their intercept-based spatial kernels and slower resampling patterns.</p>
<p>Alternatively, we have drafted a tentative risk indexing approach based on a weighted sum of subjectively scored covariate effects. While each variable would still need a carefully reasoned score, this option offers a more streamlined method that is easier to adjust. We applied this risk index to inform a risk weighted allocation of the 10-year deforestation rate, first by multiplying the fraction of pixel risk by zonal forest loss, and second by factoring out annual zonal loss by multiplying by pixel risk values, as shown below</p>
<p><span class="math display">\[
\mathrm{AllocatedLoss}_{\mathrm{pixel}}
=
\left(
  \frac{\mathrm{risk}_{\mathrm{pixel}}}{\sum \mathrm{risk}_{\mathrm{zone}}}
\right)
\times
\mathrm{annual\_loss\_10yr}_{\mathrm{zone}}
\]</span></p>
<p><span class="math display">\[
\mathrm{allocated\_loss}_{\mathrm{pixel}}
=
\mathrm{risk}_{\mathrm{pixel}}
\times
\left(
  \frac{\mathrm{annual\_loss\_10yr}_{\mathrm{zone}}}{\sum \mathrm{risk}_{\mathrm{zone}}}
\right)
\]</span></p>
<p>Both formulas describe the same operation in different orders of multiplication: each pixel in a given zone Z receives a share of annual_loss_10yr<sub>Z</sub> based on its proportional risk (the pixel’s risk relative to the sum of all pixel risks in that zone). This ensures that higher-risk pixels are allocated more deforestation, in line with the Verra guidance for an allocated deforestation risk map.</p>
<p>We intend to present both of these approaches for broader review and discussion in our upcoming meeting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>risk_index <span class="ot">&lt;-</span> (<span class="fl">0.2</span> <span class="sc">*</span> distance_to_edge) <span class="sc">+</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>              (<span class="fl">0.2</span> <span class="sc">*</span> distance_to_roads) <span class="sc">+</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>              (<span class="fl">0.2</span> <span class="sc">*</span> distance_to_places) <span class="sc">+</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>              (<span class="fl">0.1</span> <span class="sc">*</span> distance_to_urban) <span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>              (<span class="fl">0.1</span> <span class="sc">*</span> distance_to_water) <span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>              (<span class="fl">0.1</span> <span class="sc">*</span> slope)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-normalize the index to between 0 and 1</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>rmin <span class="ot">&lt;-</span> <span class="fu">global</span>(risk_index, <span class="st">"min"</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)[<span class="dv">1</span>]</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>rmax <span class="ot">&lt;-</span> <span class="fu">global</span>(risk_index, <span class="st">"max"</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)[<span class="dv">1</span>]</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>risk_index_norm <span class="ot">&lt;-</span> (risk_index <span class="sc">-</span> rmin) <span class="sc">/</span> (rmax <span class="sc">-</span> rmin)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(risk_index_norm, <span class="st">"./data/BINARY/deforestation_risk_index.tif"</span>,<span class="at">overwrite=</span>T)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns a data.frame with columns: ID, risk_index_norm_sum</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>risk_sum <span class="ot">&lt;-</span> <span class="fu">extract</span>(risk_index_norm, zones_sv, <span class="at">fun =</span> sum, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(risk_sum) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"zone_id"</span>,<span class="st">"sum_risk"</span>)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>zones_stats <span class="ot">&lt;-</span> <span class="fu">merge</span>(zones_sf, risk_sum, <span class="at">by=</span><span class="st">"zone_id"</span>, <span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>zones_rast <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(<span class="fu">vect</span>(zones_stats), risk_index_norm, <span class="at">field=</span><span class="st">"zone_id"</span>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>zones_stats<span class="sc">$</span>loss_factor <span class="ot">&lt;-</span> zones_stats<span class="sc">$</span>annual_loss_10yr <span class="sc">/</span> zones_stats<span class="sc">$</span>sum_risk</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>loss_factor_rast <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(<span class="fu">vect</span>(zones_stats), risk_index_norm, <span class="at">field=</span><span class="st">"loss_factor"</span>)</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>allocated_loss <span class="ot">&lt;-</span> risk_index_norm <span class="sc">*</span> loss_factor_rast</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(allocated_loss, <span class="st">"./data/BINARY/allocated_deforestation.tif"</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(risk_index_norm, <span class="at">main=</span><span class="st">"Deforestation risk map"</span>)</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(allocated_loss, <span class="at">main=</span><span class="st">"Allocated deforestation map"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="appendix-i-reference-period-classifiers" class="level4">
<h4 class="anchored" data-anchor-id="appendix-i-reference-period-classifiers">Appendix I: Reference Period Classifiers</h4>
<p>To run these, you may change eval=F to eval=T at the top of chunk in the .Rmd or .R file saved in the OneDrive folder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="do">########################### 2019</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># extract signatures</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>signatures_2019 <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">extract</span>(STACK_2019, samples ,<span class="at">df=</span>T) <span class="co"># watch for data formats</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>samples_signatures_2019 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(signatures_2019, samples, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"ID"</span><span class="ot">=</span><span class="st">"id"</span>))</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>samples_signatures_2019<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># set geometry to NULL for model training</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># training-test split, p=0.7 -&gt; 70% split</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>partitioned_data_2019 <span class="ot">&lt;-</span> <span class="fu">stratified_partition</span>(samples_signatures_2019,<span class="at">group_col=</span><span class="st">"label"</span>, <span class="at">train_ratio=</span><span class="fl">0.7</span>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>trainData_2019 <span class="ot">&lt;-</span> partitioned_data_2019<span class="sc">$</span>train</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>testData_2019 <span class="ot">&lt;-</span> partitioned_data_2019<span class="sc">$</span>test</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(trainData_2019<span class="sc">$</span>label)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(testData_2019<span class="sc">$</span>label)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co"># synthetic minority oversampling technique</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>trainData_2019<span class="ot">&lt;-</span>performanceEstimation<span class="sc">::</span><span class="fu">smote</span>(label <span class="sc">~</span> .,<span class="at">data=</span>trainData_2019,<span class="at">perc.over=</span><span class="dv">10</span>, <span class="at">perc.under=</span><span class="dv">100</span>)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>testData_2019<span class="ot">&lt;-</span>performanceEstimation<span class="sc">::</span><span class="fu">smote</span>(label <span class="sc">~</span> .,<span class="at">data=</span>testData_2019,<span class="at">perc.over=</span><span class="dv">10</span>,<span class="at">perc.under=</span><span class="dv">100</span>)</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="co"># interpolate NAs with class-median-normalization (NAs -&gt; missing cloud pixels)</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>trainData_2019 <span class="ot">&lt;-</span> trainData_2019 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(label) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">median</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .))) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>testData_2019 <span class="ot">&lt;-</span> testData_2019 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(label) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">median</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .))) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="co"># assign model variables</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>response  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"label"</span>)</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>predictors_2019 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NDVI_2019"</span>, <span class="st">"BLUE_2019"</span>, <span class="st">"GREEN_2019"</span>, <span class="st">"RED_2019"</span>, </span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NIR08_2019"</span>, <span class="st">"SWIR16_2019"</span>, <span class="st">"SWIR22_2019"</span>, <span class="st">"DEM"</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a><span class="co"># train classifier</span></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>rf_model_2019 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>  label<span class="sc">~</span>.,</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> trainData_2019[, <span class="fu">c</span>(predictors_2019, <span class="st">"label"</span>)], <span class="co"># drop ID var</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> cv_regime,</span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">method    =</span> <span class="st">"rf"</span>, </span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric    =</span> <span class="st">'Kappa'</span>, </span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree     =</span> <span class="dv">500</span>,</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength=</span> <span class="dv">6</span>,</span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance=</span> T</span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>rf_test_2019 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model_2019, testData_2019)</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model_2019) <span class="co"># cv results</span></span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(rf_test_2019,testData_2019<span class="sc">$</span>label) <span class="co"># blind test results</span></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>index_feature_2019 <span class="ot">&lt;-</span> <span class="fu">createMultiFolds</span>(trainData_2019<span class="sc">$</span>label, <span class="at">times=</span><span class="dv">5</span>) </span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>predictor_seq_2019 <span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>, <span class="at">to=</span><span class="fu">length</span>(predictors_2019),<span class="at">by=</span><span class="dv">2</span>)</span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>subset_regime_2019 <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(</span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"LGOCV"</span>,</span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose=</span><span class="cn">FALSE</span>,</span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">functions=</span>rfFuncs,</span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">index=</span>index_feature_2019</span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>rf_model_subset_2019 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">rfe</span>(</span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a>  label<span class="sc">~</span>.,</span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> trainData_2019[, <span class="fu">c</span>(predictors_2019, <span class="st">"label"</span>)], </span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> predictor_seq_2019,</span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"Kappa"</span>,</span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree=</span><span class="dv">500</span>,</span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"rf"</span>,</span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">rfeControl =</span> subset_regime_2019</span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a>rf_subset_test_2019 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model_subset_2019,testData_2019)</span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model_subset_2019)</span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(rf_subset_test_2019<span class="sc">$</span>pred,testData_2019<span class="sc">$</span>label)</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a><span class="do">######################### 2024</span></span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a><span class="co"># extract signatures</span></span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a>signatures_2024 <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">extract</span>(STACK_2024, samples ,<span class="at">df=</span>T) <span class="co"># watch for data formats</span></span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a>samples_signatures_2024 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(signatures_2024, samples, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"ID"</span><span class="ot">=</span><span class="st">"id"</span>))</span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a>samples_signatures_2024<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># set geometry to NULL for model training</span></span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a><span class="co"># training-test split, p=0.7 -&gt; 70% split</span></span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a>partitioned_data_2024 <span class="ot">&lt;-</span> <span class="fu">stratified_partition</span>(samples_signatures_2024,<span class="at">group_col=</span><span class="st">"label"</span>, <span class="at">train_ratio=</span><span class="fl">0.7</span>)</span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true" tabindex="-1"></a>trainData_2024 <span class="ot">&lt;-</span> partitioned_data_2024<span class="sc">$</span>train</span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true" tabindex="-1"></a>testData_2024 <span class="ot">&lt;-</span> partitioned_data_2024<span class="sc">$</span>test</span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(trainData_2024<span class="sc">$</span>label)</span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(testData_2024<span class="sc">$</span>label)</span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a><span class="co"># synthetic minority oversampling technique</span></span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a>trainData_2024<span class="ot">&lt;-</span>performanceEstimation<span class="sc">::</span><span class="fu">smote</span>(label <span class="sc">~</span> .,<span class="at">data=</span>trainData_2024,<span class="at">perc.over=</span><span class="dv">10</span>, <span class="at">perc.under=</span><span class="dv">100</span>)</span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a>testData_2024<span class="ot">&lt;-</span>performanceEstimation<span class="sc">::</span><span class="fu">smote</span>(label <span class="sc">~</span> .,<span class="at">data=</span>testData_2024,<span class="at">perc.over=</span><span class="dv">10</span>,<span class="at">perc.under=</span><span class="dv">100</span>)</span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a><span class="co"># interpolate missing cloud pixels with class-median-normalization</span></span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a>trainData_2024 <span class="ot">&lt;-</span> trainData_2024 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(label) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">median</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .))) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a>testData_2024 <span class="ot">&lt;-</span> testData_2024 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(label) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">median</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .))) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a><span class="co"># interpolate NAs with class-median-normalization (NAs -&gt; missing cloud pixels)</span></span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true" tabindex="-1"></a>trainData_2024 <span class="ot">&lt;-</span> trainData_2024 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(label) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb62-95"><a href="#cb62-95" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">median</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .))) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb62-96"><a href="#cb62-96" aria-hidden="true" tabindex="-1"></a>testData_2024 <span class="ot">&lt;-</span> testData_2024 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(label) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb62-97"><a href="#cb62-97" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">median</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .))) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb62-98"><a href="#cb62-98" aria-hidden="true" tabindex="-1"></a>water_2014 <span class="ot">&lt;-</span> trainData_2014[trainData_2014<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"Water"</span>, ]</span>
<span id="cb62-99"><a href="#cb62-99" aria-hidden="true" tabindex="-1"></a>water_ids <span class="ot">&lt;-</span> water_2014<span class="sc">$</span>ID</span>
<span id="cb62-100"><a href="#cb62-100" aria-hidden="true" tabindex="-1"></a>water_2024 <span class="ot">&lt;-</span> samples_signatures_2024[samples_signatures_2024<span class="sc">$</span>ID <span class="sc">%in%</span> water_ids, ]</span>
<span id="cb62-101"><a href="#cb62-101" aria-hidden="true" tabindex="-1"></a>trainData_2024 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(trainData_2024, water_2024)</span>
<span id="cb62-102"><a href="#cb62-102" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(trainData_2024<span class="sc">$</span>label)</span>
<span id="cb62-103"><a href="#cb62-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-104"><a href="#cb62-104" aria-hidden="true" tabindex="-1"></a><span class="co"># assign model variables</span></span>
<span id="cb62-105"><a href="#cb62-105" aria-hidden="true" tabindex="-1"></a>response  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"label"</span>)</span>
<span id="cb62-106"><a href="#cb62-106" aria-hidden="true" tabindex="-1"></a>predictors_2024 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb62-107"><a href="#cb62-107" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NDVI_2024"</span>, <span class="st">"BLUE_2024"</span>, <span class="st">"GREEN_2024"</span>, <span class="st">"RED_2024"</span>, </span>
<span id="cb62-108"><a href="#cb62-108" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NIR08_2024"</span>, <span class="st">"SWIR16_2024"</span>, <span class="st">"SWIR22_2024"</span>, <span class="st">"DEM"</span></span>
<span id="cb62-109"><a href="#cb62-109" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-110"><a href="#cb62-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-111"><a href="#cb62-111" aria-hidden="true" tabindex="-1"></a><span class="co"># train classifier</span></span>
<span id="cb62-112"><a href="#cb62-112" aria-hidden="true" tabindex="-1"></a>rf_model_2024 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb62-113"><a href="#cb62-113" aria-hidden="true" tabindex="-1"></a>  label<span class="sc">~</span>.,</span>
<span id="cb62-114"><a href="#cb62-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> trainData_2024[, <span class="fu">c</span>(predictors_2024, <span class="st">"label"</span>)], <span class="co"># drop ID var</span></span>
<span id="cb62-115"><a href="#cb62-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> cv_regime,</span>
<span id="cb62-116"><a href="#cb62-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">method    =</span> <span class="st">"rf"</span>, </span>
<span id="cb62-117"><a href="#cb62-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric    =</span> <span class="st">'Kappa'</span>, </span>
<span id="cb62-118"><a href="#cb62-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree     =</span> <span class="dv">500</span>,</span>
<span id="cb62-119"><a href="#cb62-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength=</span> <span class="dv">6</span>,</span>
<span id="cb62-120"><a href="#cb62-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance=</span> T</span>
<span id="cb62-121"><a href="#cb62-121" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-122"><a href="#cb62-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-123"><a href="#cb62-123" aria-hidden="true" tabindex="-1"></a>rf_test_2024 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model_2024, testData_2024)</span>
<span id="cb62-124"><a href="#cb62-124" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model_2024) <span class="co"># cv results</span></span>
<span id="cb62-125"><a href="#cb62-125" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(rf_test_2024,testData_2024<span class="sc">$</span>label) <span class="co"># blind test results</span></span>
<span id="cb62-126"><a href="#cb62-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-127"><a href="#cb62-127" aria-hidden="true" tabindex="-1"></a>index_feature_2024 <span class="ot">&lt;-</span> <span class="fu">createMultiFolds</span>(trainData_2024<span class="sc">$</span>label, <span class="at">times=</span><span class="dv">5</span>) </span>
<span id="cb62-128"><a href="#cb62-128" aria-hidden="true" tabindex="-1"></a>predictor_seq_2024 <span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>, <span class="at">to=</span><span class="fu">length</span>(predictors_2024),<span class="at">by=</span><span class="dv">2</span>)</span>
<span id="cb62-129"><a href="#cb62-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-130"><a href="#cb62-130" aria-hidden="true" tabindex="-1"></a>subset_regime_2024 <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(</span>
<span id="cb62-131"><a href="#cb62-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"LGOCV"</span>,</span>
<span id="cb62-132"><a href="#cb62-132" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb62-133"><a href="#cb62-133" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose=</span><span class="cn">FALSE</span>,</span>
<span id="cb62-134"><a href="#cb62-134" aria-hidden="true" tabindex="-1"></a>  <span class="at">functions=</span>rfFuncs,</span>
<span id="cb62-135"><a href="#cb62-135" aria-hidden="true" tabindex="-1"></a>  <span class="at">index=</span>index_feature_2024</span>
<span id="cb62-136"><a href="#cb62-136" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-137"><a href="#cb62-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-138"><a href="#cb62-138" aria-hidden="true" tabindex="-1"></a>rf_model_subset_2024 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">rfe</span>(</span>
<span id="cb62-139"><a href="#cb62-139" aria-hidden="true" tabindex="-1"></a>  label<span class="sc">~</span>.,</span>
<span id="cb62-140"><a href="#cb62-140" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> trainData_2024[, <span class="fu">c</span>(predictors_2024, <span class="st">"label"</span>)], </span>
<span id="cb62-141"><a href="#cb62-141" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> predictor_seq_2024,</span>
<span id="cb62-142"><a href="#cb62-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"Kappa"</span>,</span>
<span id="cb62-143"><a href="#cb62-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree=</span><span class="dv">500</span>,</span>
<span id="cb62-144"><a href="#cb62-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"rf"</span>,</span>
<span id="cb62-145"><a href="#cb62-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">rfeControl =</span> subset_regime_2024</span>
<span id="cb62-146"><a href="#cb62-146" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-147"><a href="#cb62-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-148"><a href="#cb62-148" aria-hidden="true" tabindex="-1"></a>rf_subset_test_2024 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model_subset_2024,testData_2024)</span>
<span id="cb62-149"><a href="#cb62-149" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model_subset_2024)</span>
<span id="cb62-150"><a href="#cb62-150" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(rf_subset_test_2024<span class="sc">$</span>pred,testData_2024<span class="sc">$</span>label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2014 <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">predict</span>(STACK_2014,rf_model_2014, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">|&gt;</span> raster<span class="sc">::</span><span class="fu">raster</span>()</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(LULC_LIBERIA_2014,<span class="st">"./data/LULC/LULC_LIBERIA_2014-01-04.tif"</span>,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"GTiff"</span>, <span class="at">overwrite =</span> T)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2019 <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">predict</span>(STACK_2019,rf_model_2019, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">|&gt;</span> raster<span class="sc">::</span><span class="fu">raster</span>() </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(LULC_LIBERIA_2019,<span class="st">"./data/LULC/LULC_LIBERIA_2019-01-02.tif"</span>,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"GTiff"</span>,<span class="at">overwrite =</span> T)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>LULC_LIBERIA_2024 <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">predict</span>(STACK_2024,rf_model_2014, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">|&gt;</span> raster<span class="sc">::</span><span class="fu">raster</span>() </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(LULC_LIBERIA_2024,<span class="st">"./data/LULC/LULC_LIBERIA_2024-01-16x.tif"</span>,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"GTiff"</span>,<span class="at">overwrite =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="appendix-ii-runtime-snapshot" class="level4">
<h4 class="anchored" data-anchor-id="appendix-ii-runtime-snapshot">Appendix II: Runtime snapshot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>LULC_PROJECT_2015<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/LULC_PROJECT_2015.tif"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>LULC_PROJECT_2019<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/LULC_PROJECT_2019.tif"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>LULC_PROJECT_2024<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"./data/LULC/LULC_PROJECT_2024.tif"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>LULC_PROJECT_2015<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">project</span>(LULC_PROJECT_2015, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>LULC_PROJECT_2024<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">project</span>(LULC_PROJECT_2024, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>LULC_PROJECT_2019<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">project</span>(LULC_PROJECT_2019, <span class="st">"EPSG:32629"</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>voi <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(aoi, <span class="dv">32629</span>) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">vect</span>() </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>LULC_PROJECT_2015 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">crop</span>(LULC_PROJECT_2015, voi, <span class="at">mask=</span>T)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>LULC_PROJECT_2019 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">crop</span>(LULC_PROJECT_2019, voi, <span class="at">mask=</span>T)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>LULC_PROJECT_2024 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">crop</span>(LULC_PROJECT_2024, voi, <span class="at">mask=</span>T)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>code_dict <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Water"</span>, <span class="st">"Forest"</span>, <span class="st">"Grassland"</span>, </span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Wetland"</span>, <span class="st">"Croplan"</span>, <span class="st">"Shrubland"</span>, </span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Urban"</span>, <span class="st">"Bareground"</span>))</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_PROJECT_2015) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_PROJECT_2019) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_PROJECT_2024) <span class="ot">&lt;-</span> code_dict</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(LULC_PROJECT_2015, <span class="at">main =</span> <span class="st">"LULC 2015"</span>)</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(LULC_PROJECT_2015, <span class="at">main =</span> <span class="st">"LULC 2019"</span>)</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(LULC_PROJECT_2015, <span class="at">main =</span> <span class="st">"LULC 2024"</span>)</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>raster_res <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">res</span>(LULC_PROJECT_2015) <span class="co"># 9.933065 x 9.933065 m2</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>pixel_area_ha <span class="ot">&lt;-</span> (raster_res[<span class="dv">1</span>] <span class="sc">*</span> raster_res[<span class="dv">2</span>]) <span class="sc">/</span> <span class="dv">10000</span>  <span class="co"># Convert m² to hectares</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>freq_2015 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(terra<span class="sc">::</span><span class="fu">freq</span>(LULC_PROJECT_2015))</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>freq_2015<span class="sc">$</span>area_ha <span class="ot">&lt;-</span> freq_2015<span class="sc">$</span>count <span class="sc">*</span> pixel_area_ha</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>freq_2015<span class="sc">$</span>percentage <span class="ot">&lt;-</span> (freq_2015<span class="sc">$</span>area_ha <span class="sc">/</span> <span class="fu">sum</span>(freq_2015<span class="sc">$</span>area_ha)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>freq_2015<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="dv">2015</span></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>freq_2019 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(terra<span class="sc">::</span><span class="fu">freq</span>(LULC_PROJECT_2019))</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>freq_2019<span class="sc">$</span>area_ha <span class="ot">&lt;-</span> freq_2019<span class="sc">$</span>count <span class="sc">*</span> pixel_area_ha</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>freq_2019<span class="sc">$</span>percentage <span class="ot">&lt;-</span> (freq_2019<span class="sc">$</span>area_ha <span class="sc">/</span> <span class="fu">sum</span>(freq_2019<span class="sc">$</span>area_ha)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>freq_2019<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="dv">2019</span></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>freq_2024 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(terra<span class="sc">::</span><span class="fu">freq</span>(LULC_PROJECT_2024))</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>freq_2024<span class="sc">$</span>area_ha <span class="ot">&lt;-</span> freq_2024<span class="sc">$</span>count <span class="sc">*</span> pixel_area_ha</span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>freq_2024<span class="sc">$</span>percentage <span class="ot">&lt;-</span> (freq_2024<span class="sc">$</span>area_ha <span class="sc">/</span> <span class="fu">sum</span>(freq_2024<span class="sc">$</span>area_ha)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>freq_2024<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="dv">2024</span></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>land_cover_summary<span class="ot">=</span><span class="fu">bind_rows</span>(freq_2015, freq_2019, freq_2024)</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>land_cover_summary<span class="ot">=</span><span class="fu">merge</span>(land_cover_summary,code_dict, <span class="at">by.x=</span><span class="st">"value"</span>,<span class="at">by.y=</span><span class="st">"id"</span>,<span class="at">all.x=</span>T)</span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>land_cover_summary_wide <span class="ot">&lt;-</span> land_cover_summary <span class="sc">%&gt;%</span></span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(label, year, area_ha, percentage) <span class="sc">%&gt;%</span></span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> <span class="fu">c</span>(area_ha, percentage))</span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(land_cover_summary_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>unique_values_2015 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">unique</span>(LULC_PROJECT_2015)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>unique_values_2019 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">unique</span>(LULC_PROJECT_2019)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>unique_values_2024 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">unique</span>(LULC_PROJECT_2024)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_values_2015)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_values_2019)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_values_2024)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(terra<span class="sc">::</span><span class="fu">is.factor</span>(LULC_PROJECT_2015))</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(terra<span class="sc">::</span><span class="fu">levels</span>(LULC_PROJECT_2015))</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(terra<span class="sc">::</span><span class="fu">levels</span>(LULC_PROJECT_2019))</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(terra<span class="sc">::</span><span class="fu">levels</span>(LULC_PROJECT_2024))</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_PROJECT_2015) <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> code_dict<span class="sc">$</span>id, <span class="at">label =</span> code_dict<span class="sc">$</span>label)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_PROJECT_2019) <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> code_dict<span class="sc">$</span>id, <span class="at">label =</span> code_dict<span class="sc">$</span>label)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(LULC_PROJECT_2024) <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> code_dict<span class="sc">$</span>id, <span class="at">label =</span> code_dict<span class="sc">$</span>label)</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>freq_2015 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(terra<span class="sc">::</span><span class="fu">freq</span>(LULC_PROJECT_2015))</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>freq_2019 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(terra<span class="sc">::</span><span class="fu">freq</span>(LULC_PROJECT_2019))</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>freq_2024 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(terra<span class="sc">::</span><span class="fu">freq</span>(LULC_PROJECT_2024))</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(freq_2015)</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(freq_2019)</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(freq_2024)</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(LULC_PROJECT_2015)</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(LULC_PROJECT_2019)</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(LULC_PROJECT_2024)</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(LULC_PROJECT_2015, <span class="at">main =</span> <span class="st">"LULC 2015"</span>)</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(LULC_PROJECT_2019, <span class="at">main =</span> <span class="st">"LULC 2019"</span>)</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(LULC_PROJECT_2024, <span class="at">main =</span> <span class="st">"LULC 2024"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-governmentofliberia2019" class="csl-entry" role="listitem">
Government of Liberia. 2019. <span>“Liberia’s Forest Reference Emission Level Submission to the UNFCCC.”</span>
</div>
<div id="ref-stanimirovaGlobalLandCover2023" class="csl-entry" role="listitem">
Stanimirova, Radost, Katelyn Tarrio, Konrad Turlej, Kristina McAvoy, Sophia Stonebrook, Kai-Ting Hu, Paulo Arévalo, et al. 2023. <span>“A Global Land Cover Training Dataset from 1984 to 2020.”</span> <em>Scientific Data</em> 10 (1): 879. <a href="https://doi.org/10.1038/s41597-023-02798-5">https://doi.org/10.1038/s41597-023-02798-5</a>.
</div>
<div id="ref-verraVT0007UnplannedDeforestation2021" class="csl-entry" role="listitem">
Verra. 2021. <span>“VT0007 Unplanned Deforestation Allocation Tool.”</span>
</div>
<div id="ref-woodcockGlobalLandCover" class="csl-entry" role="listitem">
Woodcock, Curtis, Pontus Olofsson, Thomas Loveland, Chris Barber, and Zhe Zhu. n.d. <span>“Global Land Cover Estimation (GLanCE) Product User Guide Version 1.0 August 2022.”</span>
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Please note that model performance metrics differ slightly with each runtime due to Monte Carlo resampling and the number of randomForest decision trees. This is to say that accuracy results in the chunk below may not be precisely matching the in-text reporting here if a new run has been implemented locally on your machine.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/17c2998f-b511-4c3f-b44d-24cddc66219d\.netlify\.app\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://github.com/seamusrobertmurphy/VM0048">Source</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>